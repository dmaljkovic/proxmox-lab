{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Proxmox Lab Infrastructure Training","text":"<p>Welcome to the comprehensive 15-day infrastructure training project. This documentation will guide you through building a complete enterprise infrastructure from bare metal to production-ready services.</p>"},{"location":"#what-youll-learn","title":"What You'll Learn","text":"<p>This training covers the complete lifecycle of modern infrastructure deployment:</p> <ul> <li>Virtualization &amp; Storage: Proxmox VE with ZFS storage pools</li> <li>Identity Management: OpenLDAP directory services with Keycloak SSO</li> <li>Collaboration Tools: Rocket.Chat and Nextcloud deployment</li> <li>Security: CIS benchmark hardening, firewalls, and intrusion prevention</li> <li>Monitoring: Prometheus and Grafana observability stack</li> <li>Documentation: MkDocs for knowledge management</li> </ul>"},{"location":"#training-timeline","title":"Training Timeline","text":"Day Topic Duration 1 Rescue mode, ZFS setup, Proxmox installation 4-6 hours 2 Create 6 virtual machines 4-5 hours 3 Rocket.Chat installation 3-4 hours 4 Nextcloud installation 3-4 hours 5 Nginx reverse proxy and SSL 4-6 hours 6 OpenLDAP server setup 3-4 hours 7 Keycloak installation and realm setup 4-5 hours 8 OIDC integration for SSO 3-4 hours 9 CIS hardening 6-8 hours 10 Firewall, Fail2Ban, and backups 4-5 hours 11 Prometheus and Grafana monitoring 4-5 hours 12 MkDocs documentation server 3-4 hours 13 Security audits 4-5 hours 14 Final testing and validation 4-5 hours 15 Advanced topics (optional) Variable"},{"location":"#prerequisites","title":"Prerequisites","text":"<p>Before starting, ensure you have:</p> <ul> <li>Hetzner EX44 server (or equivalent with 2x NVMe drives)</li> <li>Basic Linux command line knowledge</li> <li>SSH client installed</li> <li>Text editor (nano, vim, or VS Code)</li> <li>15 days of dedicated time (4-6 hours per day)</li> </ul>"},{"location":"#quick-navigation","title":"Quick Navigation","text":""},{"location":"#getting-started","title":"Getting Started","text":"<ol> <li>Prerequisites - What you need before Day 1</li> <li>Rescue Mode - Begin Day 1</li> </ol>"},{"location":"#infrastructure-building","title":"Infrastructure Building","text":"<ol> <li>VM Overview - Track your IP addresses</li> <li>Software Installation - Deploy services</li> </ol>"},{"location":"#security-operations","title":"Security &amp; Operations","text":"<ol> <li>Security Hardening - Protect your infrastructure</li> <li>Monitoring Setup - Observe everything</li> <li>Maintenance Procedures - Keep it running</li> </ol>"},{"location":"#architecture-overview","title":"Architecture Overview","text":"<pre><code>%%{init: {'theme': 'dark'}}%%\ngraph TB\n    Internet[Internet] --&gt; Nginx[Nginx Reverse Proxy&lt;br/&gt;VM-103&lt;br/&gt;nginx.example.com]\n\n    Nginx --&gt; RC[Rocket.Chat&lt;br/&gt;VM-101&lt;br/&gt;chat.example.com&lt;br/&gt;Port 3000]\n    Nginx --&gt; NC[Nextcloud&lt;br/&gt;VM-102&lt;br/&gt;cloud.example.com&lt;br/&gt;Port 80]\n    Nginx --&gt; KC[Keycloak SSO&lt;br/&gt;VM-106&lt;br/&gt;auth.example.com&lt;br/&gt;Port 8080]\n    Nginx --&gt; MD[MkDocs&lt;br/&gt;VM-104&lt;br/&gt;docs.example.com&lt;br/&gt;Port 8000]\n\n    KC --&gt; LDAP[OpenLDAP&lt;br/&gt;VM-105&lt;br/&gt;Port 389/636]\n\n    Prometheus[Prometheus&lt;br/&gt;Proxmox Host&lt;br/&gt;Port 9090] --&gt; RC\n    Prometheus --&gt; NC\n    Prometheus --&gt; Nginx\n    Prometheus --&gt; MD\n    Prometheus --&gt; LDAP\n    Prometheus --&gt; KC\n\n    Grafana[Grafana&lt;br/&gt;Proxmox Host&lt;br/&gt;Port 3000] --&gt; Prometheus</code></pre>"},{"location":"#technology-stack","title":"Technology Stack","text":"Category Technology Version Virtualization Proxmox VE 8.2 Operating System Ubuntu Server 24.04 LTS Container Runtime Docker 24.x Chat Platform Rocket.Chat 6.x File Sync Nextcloud 28.x Identity Provider Keycloak 24.0.0 Directory Services OpenLDAP 2.5.x Reverse Proxy Nginx 1.24 Monitoring Prometheus 2.51.0 Visualization Grafana 10.x Documentation MkDocs Latest"},{"location":"#important-notes","title":"Important Notes","text":"<p>Production Use</p> <p>This documentation uses <code>example.com</code> as a placeholder domain. Replace with your actual domain in production environments.</p> <p>Data Safety</p> <p>Several operations in this training involve disk partitioning and data destruction. Always verify you're working on the correct system before executing commands.</p> <p>Documentation Format</p> <p>Each document follows this pattern: 1. Prerequisites checklist 2. Step-by-step instructions 3. Verification steps 4. Daily completion checklist</p>"},{"location":"#support","title":"Support","text":"<p>For issues or questions: - Review the Troubleshooting Guide - Check Common Commands - Refer to specific technology documentation</p>"},{"location":"#next-steps","title":"Next Steps","text":"<p>Ready to begin? Start with Prerequisites to ensure you have everything needed, then proceed to Day 1 - Rescue Mode.</p>"},{"location":"01-preparation/01-rescue-mode/","title":"Rescue Mode and Initial Access","text":"<p>Brief description: Access your Hetzner server in rescue mode to prepare for Proxmox installation.</p>"},{"location":"01-preparation/01-rescue-mode/#what-youll-learn","title":"What You'll Learn","text":"<ul> <li>How to activate rescue mode in Hetzner Robot</li> <li>How to SSH into the rescue environment</li> <li>How to identify NVMe storage devices</li> </ul>"},{"location":"01-preparation/01-rescue-mode/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Hetzner EX44 server ordered and delivered</li> <li>[ ] Access to Hetzner Robot portal (https://robot.hetzner.com)</li> <li>[ ] SSH client installed on your local machine</li> <li>[ ] Server IP address from Hetzner</li> </ul>"},{"location":"01-preparation/01-rescue-mode/#estimated-time","title":"Estimated Time","text":"<p>30-45 minutes</p>"},{"location":"01-preparation/01-rescue-mode/#step-by-step-instructions","title":"Step-by-Step Instructions","text":""},{"location":"01-preparation/01-rescue-mode/#step-1-access-hetzner-robot-portal","title":"Step 1: Access Hetzner Robot Portal","text":"<ol> <li>Open your web browser</li> <li>Navigate to https://robot.hetzner.com</li> <li>Log in with your credentials</li> <li>Click on your server in the server list</li> </ol>"},{"location":"01-preparation/01-rescue-mode/#step-2-activate-rescue-mode","title":"Step 2: Activate Rescue Mode","text":"<ol> <li>Click the \"Rescue\" tab in the server details</li> <li>Select \"Linux 64-bit\" from the operating system dropdown</li> <li>Click \"Activate rescue mode\" button</li> <li>A root password will be displayed - copy this to a secure location</li> <li>Click \"Send CTRL+ALT+DEL to reset\" or power cycle the server</li> <li>Wait 2-3 minutes for the server to boot into rescue mode</li> </ol>"},{"location":"01-preparation/01-rescue-mode/#step-3-ssh-into-rescue-mode","title":"Step 3: SSH into Rescue Mode","text":"<p>Open your terminal and connect:</p> <pre><code>ssh root@&lt;your-server-ip&gt;\n</code></pre> <p>When prompted for password, enter the rescue password from Step 2.</p> <p>You should see output similar to: <pre><code>Rescue System 6.0.1\nroot@rescue ~ #\n</code></pre></p>"},{"location":"01-preparation/01-rescue-mode/#step-4-verify-nvme-devices","title":"Step 4: Verify NVMe Devices","text":"<p>List available storage devices:</p> <pre><code>lsblk\n</code></pre> <p>Expected output: <pre><code>NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT\nnvme0n1     259:0    0 476.9G  0 disk \nnvme1n1     259:1    0 476.9G  0 disk\n</code></pre></p> <p>Verify device details:</p> <pre><code>fdisk -l | grep nvme\n</code></pre> <p>Expected output: <pre><code>Disk /dev/nvme0n1: 476.94 GiB, 512110190592 bytes, 1000215216 sectors\nDisk /dev/nvme1n1: 476.94 GiB, 512110190592 bytes, 1000215216 sectors\n</code></pre></p> <p>Device Verification</p> <p>Ensure you see exactly two NVMe devices (<code>/dev/nvme0n1</code> and <code>/dev/nvme1n1</code>) before proceeding. If you see different devices, stop and verify your server configuration.</p>"},{"location":"01-preparation/01-rescue-mode/#step-5-update-rescue-system","title":"Step 5: Update Rescue System","text":"<p>Update package lists:</p> <pre><code>apt update\n</code></pre> <p>Install essential tools:</p> <pre><code>apt install -y wget curl vim\n</code></pre>"},{"location":"01-preparation/01-rescue-mode/#verification","title":"Verification","text":"<ul> <li>[ ] Successfully accessed Hetzner Robot portal</li> <li>[ ] Rescue mode activated successfully</li> <li>[ ] SSH connection established to rescue environment</li> <li>[ ] Both NVMe devices identified (<code>/dev/nvme0n1</code> and <code>/dev/nvme1n1</code>)</li> <li>[ ] Rescue system updated</li> </ul>"},{"location":"01-preparation/01-rescue-mode/#common-issues","title":"Common Issues","text":""},{"location":"01-preparation/01-rescue-mode/#issue-cannot-connect-via-ssh","title":"Issue: Cannot connect via SSH","text":"<p>Solution: Wait 3-5 minutes after activating rescue mode for the server to fully boot.</p>"},{"location":"01-preparation/01-rescue-mode/#issue-permission-denied-password","title":"Issue: Permission denied (password)","text":"<p>Solution: Copy the password exactly as shown in Hetzner Robot (case-sensitive). If still failing, reactivate rescue mode to get a new password.</p>"},{"location":"01-preparation/01-rescue-mode/#issue-only-one-nvme-device-visible","title":"Issue: Only one NVMe device visible","text":"<p>Solution: Check Hetzner Robot hardware details. Contact Hetzner support if hardware doesn't match order.</p>"},{"location":"01-preparation/01-rescue-mode/#next-steps","title":"Next Steps","text":"<p>Proceed to ZFS Setup to create your storage pool.</p>"},{"location":"01-preparation/02-proxmox-installation/","title":"Proxmox Installation (QEMU Method)","text":"<p>Brief description: Install Proxmox VE 9.x on your Hetzner server using the QEMU-based ISO installation method from rescue mode.</p>"},{"location":"01-preparation/02-proxmox-installation/#what-youll-learn","title":"What You'll Learn","text":"<ul> <li>How to boot Proxmox installer in a virtual machine from rescue mode</li> <li>How to pass NVMe drives through to the installer</li> <li>How to access the installer via VNC</li> <li>How to configure Proxmox with ZFS during installation</li> </ul>"},{"location":"01-preparation/02-proxmox-installation/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Rescue mode activated and SSH connected</li> <li>[ ] Both NVMe devices identified (<code>/dev/nvme0n1</code> and <code>/dev/nvme1n1</code>)</li> <li>[ ] VNC client installed on your local machine</li> <li>[ ] At least 4GB free space for ISO download</li> </ul>"},{"location":"01-preparation/02-proxmox-installation/#estimated-time","title":"Estimated Time","text":"<p>45-60 minutes</p> <p>Data Destruction Warning</p> <p>This installation will erase all data on your NVMe drives. Ensure you have no important data. This is a fresh server setup.</p>"},{"location":"01-preparation/02-proxmox-installation/#step-by-step-instructions","title":"Step-by-Step Instructions","text":""},{"location":"01-preparation/02-proxmox-installation/#step-1-check-boot-mode-uefibios","title":"Step 1: Check Boot Mode (UEFI/BIOS)","text":"<p>Determine if your server uses UEFI or legacy BIOS:</p> <pre><code>[ -d \"/sys/firmware/efi\" ] &amp;&amp; echo \"UEFI\" || echo \"BIOS\"\n</code></pre> <p>Note the result - you'll need it for the QEMU commands.</p>"},{"location":"01-preparation/02-proxmox-installation/#step-2-forward-vnc-port","title":"Step 2: Forward VNC Port","text":"<p>Forward a local port to access the virtual machine's VNC console:</p> <pre><code>ssh -L 5900:localhost:5900 root@&lt;your-server-ip&gt;\n</code></pre> <p>Keep this SSH session open during the entire installation process.</p>"},{"location":"01-preparation/02-proxmox-installation/#step-3-download-proxmox-ve-iso","title":"Step 3: Download Proxmox VE ISO","text":"<p>Download the Proxmox VE ISO from the official source:</p> <pre><code>cd /tmp\nwget https://enterprise.proxmox.com/iso/proxmox-ve_9.0-1.iso\n</code></pre> <p>Verify the download:</p> <pre><code>ls -lh proxmox-ve_9.0-1.iso\n</code></pre> <p>Expected size: ~1.1GB</p>"},{"location":"01-preparation/02-proxmox-installation/#step-4-start-proxmox-installer-in-qemu","title":"Step 4: Start Proxmox Installer in QEMU","text":"<p>Start a virtual machine with the Proxmox ISO and pass your NVMe drives through:</p> <p>For UEFI servers:</p> <pre><code>qemu-system-x86_64 \\\n  -enable-kvm \\\n  -cpu host \\\n  -m 16G \\\n  -boot d \\\n  -cdrom ./proxmox-ve_9.0-1.iso \\\n  -drive file=/dev/nvme0n1,format=raw,if=virtio \\\n  -drive file=/dev/nvme1n1,format=raw,if=virtio \\\n  -bios /usr/share/OVMF/OVMF_CODE.fd \\\n  -vnc 127.0.0.1:0\n</code></pre> <p>For legacy BIOS servers (remove the <code>-bios</code> line):</p> <pre><code>qemu-system-x86_64 \\\n  -enable-kvm \\\n  -cpu host \\\n  -m 16G \\\n  -boot d \\\n  -cdrom ./proxmox-ve_9.0-1.iso \\\n  -drive file=/dev/nvme0n1,format=raw,if=virtio \\\n  -drive file=/dev/nvme1n1,format=raw,if=virtio \\\n  -vnc 127.0.0.1:0\n</code></pre> <p>Drive Naming</p> <p>If you have SATA drives instead of NVMe, use <code>/dev/sda</code> and <code>/dev/sdb</code> instead of <code>/dev/nvme0n1</code> and <code>/dev/nvme1n1</code>.</p>"},{"location":"01-preparation/02-proxmox-installation/#step-5-connect-via-vnc","title":"Step 5: Connect via VNC","text":"<p>Connect your VNC client to:</p> <pre><code>127.0.0.1:5900\n</code></pre> <p>You should see the Proxmox installer boot menu.</p> <p>VNC Timeout</p> <p>The VNC connection may timeout after you press \"Install\". Simply reconnect to <code>127.0.0.1:5900</code> if this happens.</p>"},{"location":"01-preparation/02-proxmox-installation/#step-6-complete-proxmox-installation","title":"Step 6: Complete Proxmox Installation","text":"<p>Follow the on-screen installer steps:</p> <ol> <li>Select \"Install Proxmox VE\"</li> <li>Choose your target disks (both NVMe drives should be visible)</li> <li>Select \"ZFS - RAID1\" for the filesystem (the installer handles ZFS setup)</li> <li>Configure:</li> <li>Location/Timezone</li> <li>Password</li> <li>Network (temporary - we'll configure properly later)</li> <li>Wait for installation to complete</li> </ol>"},{"location":"01-preparation/02-proxmox-installation/#step-7-stop-qemu-and-prepare-for-boot","title":"Step 7: Stop QEMU and Prepare for Boot","text":"<p>Once installation shows \"Finished\", stop QEMU by pressing <code>Ctrl+C</code> in your SSH terminal.</p> <p>Before rebooting the server, you need to identify the correct network interface name.</p>"},{"location":"01-preparation/02-proxmox-installation/#step-8-identify-network-interface-name","title":"Step 8: Identify Network Interface Name","text":"<p>Run the predict-check command to find the actual interface name:</p> <pre><code>predict-check\n</code></pre> <p>Example output: <pre><code>eth0 -&gt; enp0s31f6\n</code></pre></p> <p>In this example, <code>enp0s31f6</code> is the true interface name.</p> <p>Check the current network configuration in rescue mode:</p> <pre><code>netdata\n</code></pre> <p>Example output: <pre><code>Network data:\n   eth0  LINK: yes\n         MAC:  aa:bb:cc:dd:cc:ff\n         IP:   192.168.1.100/24\n         IPv6: (none)\n         Intel(R) PRO/1000 Network Driver\n</code></pre></p> <p>Note the MAC address and IP configuration.</p>"},{"location":"01-preparation/02-proxmox-installation/#step-9-boot-into-proxmox","title":"Step 9: Boot into Proxmox","text":"<p>Start Proxmox without the ISO to boot from the installed system:</p> <p>For UEFI servers:</p> <pre><code>qemu-system-x86_64 \\\n  -enable-kvm \\\n  -cpu host \\\n  -m 16G \\\n  -boot d \\\n  -drive file=/dev/nvme0n1,format=raw,if=virtio \\\n  -drive file=/dev/nvme1n1,format=raw,if=virtio \\\n  -bios /usr/share/OVMF/OVMF_CODE.fd \\\n  -vnc 127.0.0.1:0\n</code></pre> <p>For legacy BIOS servers:</p> <pre><code>qemu-system-x86_64 \\\n  -enable-kvm \\\n  -cpu host \\\n  -m 16G \\\n  -boot d \\\n  -drive file=/dev/nvme0n1,format=raw,if=virtio \\\n  -drive file=/dev/nvme1n1,format=raw,if=virtio \\\n  -vnc 127.0.0.1:0\n</code></pre>"},{"location":"01-preparation/02-proxmox-installation/#step-10-configure-network","title":"Step 10: Configure Network","text":"<p>Connect via VNC again. Log in to the Proxmox console and edit the network configuration:</p> <pre><code>nano /etc/network/interfaces\n</code></pre> <p>Adjust the interface name to match what you found in Step 8. For example:</p> <pre><code>auto lo\niface lo inet loopback\n\nauto enp0s31f6\niface enp0s31f6 inet static\n        address &lt;your-server-ip&gt;/32\n        gateway &lt;your-gateway-ip&gt;\n</code></pre> <p>Save and exit (Ctrl+O, Enter, Ctrl+X).</p>"},{"location":"01-preparation/02-proxmox-installation/#step-11-reboot-into-production","title":"Step 11: Reboot into Production","text":"<p>Power cycle the server or use the Proxmox console to reboot:</p> <pre><code>reboot\n</code></pre> <p>Your SSH session will disconnect. The server will boot directly into Proxmox.</p>"},{"location":"01-preparation/02-proxmox-installation/#step-12-access-proxmox-web-ui","title":"Step 12: Access Proxmox Web UI","text":"<p>After 5 minutes, access the Proxmox Web UI:</p> <pre><code>https://&lt;your-server-ip&gt;:8006\n</code></pre> <p>SSL Certificate Warning</p> <p>You will see a browser warning about an untrusted certificate. This is normal. Click \"Advanced\" and proceed.</p> <p>Login credentials: - Username: root - Password: (set during installation)</p>"},{"location":"01-preparation/02-proxmox-installation/#verification","title":"Verification","text":"<ul> <li>[ ] Proxmox VE ISO downloaded successfully</li> <li>[ ] QEMU virtual machine started with NVMe drives passed through</li> <li>[ ] VNC connection established to installer</li> <li>[ ] Proxmox installed on ZFS RAID1</li> <li>[ ] Network interface configured correctly</li> <li>[ ] Web UI accessible on port 8006</li> <li>[ ] Successfully logged in as root</li> </ul>"},{"location":"01-preparation/02-proxmox-installation/#next-steps","title":"Next Steps","text":"<p>Proceed to Network Configuration to configure your network setup.</p>"},{"location":"01-preparation/03-network-configuration/","title":"Network Configuration","text":"<p>Brief description: Configure your network setup for Proxmox VE on Hetzner. This covers routed, bridged, vSwitch, cloud network, and NAT configurations.</p>"},{"location":"01-preparation/03-network-configuration/#what-youll-learn","title":"What You'll Learn","text":"<ul> <li>How Hetzner's IP/MAC binding works</li> <li>How to configure different network setups</li> <li>How to enable IP forwarding for routed setups</li> <li>How to set up NAT/masquerading for VMs</li> </ul>"},{"location":"01-preparation/03-network-configuration/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Proxmox VE installed and accessible via web UI</li> <li>[ ] Server IP address and gateway from Hetzner</li> <li>[ ] Additional IPs or subnets (if applicable)</li> <li>[ ] SSH access to Proxmox host</li> </ul>"},{"location":"01-preparation/03-network-configuration/#estimated-time","title":"Estimated Time","text":"<p>30-45 minutes</p>"},{"location":"01-preparation/03-network-configuration/#understanding-hetzner-network","title":"Understanding Hetzner Network","text":"<p>Hetzner has strict IP/MAC binding for security. Key points:</p> <ul> <li>Main IP and additional single IPs are bound to the server's main MAC address</li> <li>Additional subnets (except failover) can use virtual MAC addresses</li> <li>Failover IPs and failover subnets require routed setup</li> <li>Virtual MAC addresses can only be generated for single additional IPs in Robot Panel</li> </ul> <p>Bridged Setup Warning</p> <p>In bridged mode, packets will have the VM's MAC address. Without a virtual MAC, traffic may be flagged as abuse and could lead to server blocking.</p>"},{"location":"01-preparation/03-network-configuration/#ip-forwarding","title":"IP Forwarding","text":"<p>For routed setups, enable IP forwarding:</p> <pre><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward\necho 1 &gt; /proc/sys/net/ipv6/conf/all/forwarding\n</code></pre> <p>Apply permanently:</p> <pre><code>systemctl restart systemd-sysctl\n</code></pre> <p>Verify:</p> <pre><code>sysctl net.ipv4.ip_forward\nsysctl net.ipv6.conf.all.forwarding\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#network-configuration-options","title":"Network Configuration Options","text":"<p>Choose one of the following setups:</p> <ul> <li>Routed Setup</li> <li>Bridged Setup</li> <li>vSwitch with Public Subnet</li> <li>Hetzner Cloud Network</li> <li>Masquerading (NAT)</li> </ul>"},{"location":"01-preparation/03-network-configuration/#1-routed-setup","title":"1. Routed Setup","text":"<p>In routed configuration, the host bridge IP serves as the gateway. Use <code>/32</code> mask for additional IPs not in the same subnet.</p>"},{"location":"01-preparation/03-network-configuration/#example-network-data","title":"Example Network Data","text":"<p>Replace these with your actual values: - Main IP: <code>198.51.100.10/24</code> - Gateway: <code>198.51.100.1</code> - Additional Subnet: <code>203.0.113.0/24</code> - Additional single IP (foreign subnet): <code>192.0.2.20/24</code> - Additional single IP (same subnet): <code>198.51.100.30/24</code> - Failover IP: <code>172.17.234.100/32</code> - IPv6: <code>2001:DB8::/64</code></p>"},{"location":"01-preparation/03-network-configuration/#host-configuration","title":"Host Configuration","text":"<p>Edit <code>/etc/network/interfaces</code>:</p> <pre><code># /etc/network/interfaces\n\nauto lo\niface lo inet loopback\n\niface lo inet6 loopback\n\nauto enp0s31f6\niface enp0s31f6 inet static\n        address 198.51.100.10/32\n        gateway 198.51.100.1\n\n        post-up echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n        post-up echo 1 &gt; /proc/sys/net/ipv6/conf/all/forwarding\n\n# IPv6 for main interface\niface enp0s31f6 inet6 static\n        address 2001:db8::2/128\n        gateway fe80::1\n\n# Bridge for single IPs\nauto vmbr0\niface vmbr0 inet static\n        address 198.51.100.10/32\n        bridge-ports none\n        bridge-stp off\n        bridge-fd 0\n        post-up ip route add 192.0.2.20/32 dev vmbr0     # Foreign subnet IP\n        post-up ip route add 198.51.100.30/32 dev vmbr0  # Same subnet IP\n        post-up ip route add 172.17.234.100/32 dev vmbr0 # Failover IP\n\n# IPv6 for bridge\niface vmbr0 inet6 static\n       address 2001:db8::3/64\n\n# Additional Subnet\nauto vmbr1\niface vmbr1 inet static\n        address 203.0.113.1/24\n        bridge-ports none\n        bridge-stp off\n        bridge-fd 0\n\n# Failover Subnet\nauto vmbr2\niface vmbr2 inet static\n        address 172.17.234.1/24\n        bridge-ports none\n        bridge-stp off\n        bridge-fd 0\n</code></pre> <p>Network Restart</p> <p>Restart networking after applying changes. If VMs are running, stop and start them again (not restart) to recreate point-to-point connections.</p> <p>Apply changes:</p> <pre><code>systemctl restart networking\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#guest-vm-configuration-debianubuntu","title":"Guest VM Configuration (Debian/Ubuntu)","text":""},{"location":"01-preparation/03-network-configuration/#additional-ip-from-same-subnet","title":"Additional IP from same subnet:","text":"<pre><code># /etc/network/interfaces\n\nauto lo\niface lo inet loopback\n\nauto ens18\niface ens18 inet static\n        address 198.51.100.30/32\n        gateway 198.51.100.10\n\n# IPv6\niface ens18 inet6 static\n        address 2001:DB8::4/64\n        gateway 2001:DB8::3\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#additional-ip-from-foreign-subnet","title":"Additional IP from foreign subnet:","text":"<pre><code>auto ens18\niface ens18 inet static\n        address 192.0.2.20/32\n        gateway 198.51.100.10\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#ip-from-additional-subnet","title":"IP from additional subnet:","text":"<pre><code>auto ens18\niface ens18 inet static\n        address 203.0.113.10/24\n        gateway 203.0.113.1\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#ip-from-failover-subnet","title":"IP from failover subnet:","text":"<pre><code>auto ens18\niface ens18 inet static\n        address 172.17.234.10/24\n        gateway 172.17.234.1\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#single-failover-ip","title":"Single failover IP:","text":"<pre><code>auto ens18\niface ens18 inet static\n        address 172.17.234.100/32\n        gateway 198.51.100.10\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#2-bridged-setup","title":"2. Bridged Setup","text":"<p>In bridged mode, the host acts as a transparent bridge. You must request virtual MAC addresses for each additional IP in the Robot Panel.</p>"},{"location":"01-preparation/03-network-configuration/#host-configuration_1","title":"Host Configuration","text":"<pre><code># /etc/network/interfaces\n\nauto lo\niface lo inet loopback\n\nauto enp0s31f6\niface enp0s31f6 inet manual\n\nauto vmbr0\niface vmbr0 inet static\n        address 198.51.100.10/32\n        gateway 198.51.100.1\n        bridge-ports enp0s31f6\n        bridge-stp off\n        bridge-fd 0\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#guest-vm-configuration","title":"Guest VM Configuration","text":""},{"location":"01-preparation/03-network-configuration/#static-configuration","title":"Static configuration:","text":"<pre><code># /etc/network/interfaces\n\nauto ens18\niface ens18 inet static\n        address 192.0.2.20/32\n        gateway 192.0.2.1\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#dhcp-configuration","title":"DHCP configuration:","text":"<pre><code># /etc/network/interfaces\n\nauto lo\niface lo inet loopback\n\nauto ens18\niface ens18 inet dhcp\n        hwaddress ether aa:bb:cc:dd:ee:ff\n</code></pre> <p>Use the virtual MAC address generated in the Robot Panel.</p> <p>For LXC containers, configure via Proxmox GUI: 1. Select container \u2192 Network 2. Click on the bridge 3. Select DHCP and add the MAC address from Robot Panel</p>"},{"location":"01-preparation/03-network-configuration/#3-vswitch-with-public-subnet","title":"3. vSwitch with Public Subnet","text":"<p>Connect VMs directly to a Hetzner vSwitch with a public subnet. VLAN tagging is handled automatically.</p> <p>Example subnet: <code>203.0.113.0/24</code> Example VLAN ID: <code>4009</code></p>"},{"location":"01-preparation/03-network-configuration/#host-configuration_2","title":"Host Configuration","text":"<pre><code># /etc/network/interfaces\n\nauto enp0s31f6.4009\niface enp0s31f6.4009 inet manual\n\nauto vmbr4009\niface vmbr4009 inet static\n        bridge-ports enp0s31f6.4009\n        bridge-stp off\n        bridge-fd 0\n        mtu 1400\n# vSwitch Subnet 203.0.113.0/24\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#guest-vm-configuration_1","title":"Guest VM Configuration","text":"<pre><code># /etc/network/interfaces\n\nauto lo\niface lo inet loopback\n\nauto ens18\niface ens18 inet static\n        address 203.0.113.2/24\n        gateway 203.0.113.1\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#4-hetzner-cloud-network","title":"4. Hetzner Cloud Network","text":"<p>Connect VMs to a Hetzner Cloud Network for private networking.</p> <p>Example configuration: - Cloud Network: <code>192.168.0.0/16</code> - Cloud Subnet: <code>192.168.0.0/24</code> - vSwitch: <code>192.168.1.0/24</code> - VLAN ID: <code>4000</code></p>"},{"location":"01-preparation/03-network-configuration/#host-configuration_3","title":"Host Configuration","text":"<pre><code># /etc/network/interfaces\n\nauto enp0s31f6.4000\niface enp0s31f6.4000 inet manual\n\nauto vmbr4000\niface vmbr4000 inet static\n        address 192.168.1.10/24\n        bridge-ports enp0s31f6.4000\n        bridge-stp off\n        bridge-fd 0\n        mtu 1400\n        post-up ip route add 192.168.0.0/16 via 192.168.1.1 dev vmbr4000\n# vSwitch to Cloud Network\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#guest-vm-configuration_2","title":"Guest VM Configuration","text":"<pre><code># /etc/network/interfaces\n\nauto lo\niface lo inet loopback\n\nauto ens18\niface ens18 inet static\n        address 192.168.1.2/24\n        gateway 192.168.1.1\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#5-masquerading-nat","title":"5. Masquerading (NAT)","text":"<p>Use NAT when you don't have additional public IPs. All VMs use the host's public IP for outbound traffic.</p>"},{"location":"01-preparation/03-network-configuration/#host-configuration_4","title":"Host Configuration","text":"<pre><code># /etc/network/interfaces\n\nauto lo\niface lo inet loopback\n\niface lo inet6 loopback\n\nauto enp0s31f6\niface enp0s31f6 inet static\n        address 198.51.100.10/24\n        gateway 198.51.100.1\n        post-up echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n\nauto vmbr4\niface vmbr4 inet static\n        address 172.16.16.1/24\n        bridge-ports none\n        bridge-stp off\n        bridge-fd 0\n        post-up   iptables -t nat -A POSTROUTING -s '172.16.16.0/24' -o enp0s31f6 -j MASQUERADE\n        post-down iptables -t nat -D POSTROUTING -s '172.16.16.0/24' -o enp0s31f6 -j MASQUERADE\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#optional-port-forwarding","title":"Optional: Port Forwarding","text":"<p>This forwards incoming traffic (except ports 22 and 8006) to a specific VM:</p> <pre><code>post-up iptables -t nat -A PREROUTING -i enp0s31f6 -p tcp -m multiport ! --dports 22,8006 -j DNAT --to 172.16.16.2\npost-down iptables -t nat -D PREROUTING -i enp0s31f6 -p tcp -m multiport ! --dports 22,8006 -j DNAT --to 172.16.16.2\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#guest-vm-configuration_3","title":"Guest VM Configuration","text":"<pre><code># /etc/network/interfaces\n\nauto lo\niface lo inet loopback\n\nauto ens18\niface ens18 inet static\n        address 172.16.16.2/24\n        gateway 172.16.16.1\n</code></pre>"},{"location":"01-preparation/03-network-configuration/#applying-network-changes","title":"Applying Network Changes","text":"<p>After making changes, apply them:</p> <pre><code>systemctl restart networking\n</code></pre> <p>Running VMs</p> <p>If VMs are running when restarting networking, you must stop and start them again (not restart) to recreate their network connections.</p>"},{"location":"01-preparation/03-network-configuration/#verification","title":"Verification","text":"<ul> <li>[ ] Network configuration matches your setup type</li> <li>[ ] Proxmox host is reachable via main IP</li> <li>[ ] VMs can communicate as expected</li> <li>[ ] NAT/forwarding works correctly (if applicable)</li> </ul>"},{"location":"01-preparation/03-network-configuration/#security-recommendations","title":"Security Recommendations","text":"<p>Consider these additional security measures:</p> <ul> <li>Two-Factor Authentication for Proxmox</li> <li>Fail2ban against Brute-force attacks</li> <li>Securing SSH Service</li> </ul>"},{"location":"01-preparation/03-network-configuration/#next-steps","title":"Next Steps","text":"<p>Proceed to VM Overview to prepare for creating your virtual machines.</p>"},{"location":"02-vm-creation/01-overview/","title":"VM Creation Overview","text":"<p>Brief description: Plan and document your six virtual machines before creation.</p>"},{"location":"02-vm-creation/01-overview/#what-youll-learn","title":"What You'll Learn","text":"<ul> <li>VM specifications and requirements</li> <li>Network planning</li> <li>IP address documentation</li> </ul>"},{"location":"02-vm-creation/01-overview/#virtual-machine-specifications","title":"Virtual Machine Specifications","text":"VM Name VM ID CPU RAM Disk Purpose VM-1 rocketchat 101 2 vCPU 4 GiB 30 GiB Rocket.Chat server VM-2 nextcloud 102 2 vCPU 6 GiB 50 GiB Nextcloud server VM-3 nginx-proxy 103 1 vCPU 2 GiB 10 GiB Reverse proxy VM-4 mkdocs 104 1 vCPU 2 GiB 10 GiB Documentation server VM-5 openldap 105 1 vCPU 2 GiB 10 GiB LDAP directory VM-6 keycloak 106 2 vCPU 4 GiB 20 GiB SSO/IdP server"},{"location":"02-vm-creation/01-overview/#ip-address-inventory-template","title":"IP Address Inventory Template","text":"<p>Copy this table and fill in your actual IP addresses as you create each VM:</p>"},{"location":"02-vm-creation/01-overview/#your-infrastructure-ip-table","title":"Your Infrastructure IP Table","text":"VM Name VM ID Internal IP Public Domain Services rocketchat 101 <code>___</code> chat.example.com Rocket.Chat Port 3000 nextcloud 102 <code>___</code> cloud.example.com Nextcloud Port 80/443 nginx-proxy 103 <code>___</code> proxy.example.com Nginx Port 80/443 mkdocs 104 <code>___</code> docs.example.com MkDocs Port 8000 openldap 105 <code>___</code> ldap.example.com LDAP Port 389/636 keycloak 106 <code>___</code> auth.example.com Keycloak Port 8080"},{"location":"02-vm-creation/01-overview/#example-filled","title":"Example (Filled)","text":"VM Name VM ID Internal IP Public Domain Services rocketchat 101 10.0.0.101 chat.example.com Rocket.Chat Port 3000 nextcloud 102 10.0.0.102 cloud.example.com Nextcloud Port 80/443 nginx-proxy 103 10.0.0.103 proxy.example.com Nginx Port 80/443 mkdocs 104 10.0.0.104 docs.example.com MkDocs Port 8000 openldap 105 10.0.0.105 ldap.example.com LDAP Port 389/636 keycloak 106 10.0.0.106 auth.example.com Keycloak Port 8080"},{"location":"02-vm-creation/01-overview/#network-architecture","title":"Network Architecture","text":"<pre><code>%%{init: {'theme': 'dark'}}%%\ngraph TB\n    subgraph \"Proxmox Host\"\n        subgraph \"vmbr0 Bridge Network\"\n            VM1[VM-101&lt;br/&gt;Rocket.Chat&lt;br/&gt;&lt;rocketchat-ip&gt;:3000]\n            VM2[VM-102&lt;br/&gt;Nextcloud&lt;br/&gt;&lt;nextcloud-ip&gt;:80]\n            VM3[VM-103&lt;br/&gt;Nginx Proxy&lt;br/&gt;&lt;nginx-ip&gt;:80/443]\n            VM4[VM-104&lt;br/&gt;MkDocs&lt;br/&gt;&lt;mkdocs-ip&gt;:8000]\n            VM5[VM-105&lt;br/&gt;OpenLDAP&lt;br/&gt;&lt;ldap-ip&gt;:389]\n            VM6[VM-106&lt;br/&gt;Keycloak&lt;br/&gt;&lt;keycloak-ip&gt;:8080]\n        end\n    end\n\n    Internet --&gt;|443| VM3\n    VM3 --&gt;|3000| VM1\n    VM3 --&gt;|80| VM2\n    VM3 --&gt;|8080| VM6\n    VM3 --&gt;|8000| VM4\n    VM6 --&gt;|389| VM5</code></pre>"},{"location":"02-vm-creation/01-overview/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Proxmox VE 8.2 installed and accessible</li> <li>[ ] ZFS storage pool <code>rpool</code> visible in Proxmox</li> <li>[ ] Ubuntu Server 24.04 LTS ISO uploaded (see below)</li> <li>[ ] Network bridge <code>vmbr0</code> configured (default)</li> </ul>"},{"location":"02-vm-creation/01-overview/#upload-ubuntu-iso","title":"Upload Ubuntu ISO","text":"<p>Before creating VMs, upload the Ubuntu ISO:</p> <ol> <li> <p>Download Ubuntu Server 24.04 LTS:    <pre><code># From your local machine\nwget https://releases.ubuntu.com/24.04/ubuntu-24.04-live-server-amd64.iso\n</code></pre></p> </li> <li> <p>In Proxmox Web UI:</p> </li> <li>Navigate to Datacenter \u2192 Storage \u2192 local</li> <li>Click ISO Images</li> <li>Click Upload</li> <li>Select the downloaded ISO file</li> <li> <p>Wait for upload to complete</p> </li> <li> <p>Verify upload:</p> </li> <li>ISO should appear in the ISO Images list</li> <li>Size should be approximately 2GB</li> </ol>"},{"location":"02-vm-creation/01-overview/#creation-strategy","title":"Creation Strategy","text":""},{"location":"02-vm-creation/01-overview/#recommended-order","title":"Recommended Order","text":"<ol> <li>VM-103 (Nginx Proxy) - Create first for early testing</li> <li>VM-101 (Rocket.Chat) - Core communication service</li> <li>VM-102 (Nextcloud) - File sharing service</li> <li>VM-106 (Keycloak) - Identity management</li> <li>VM-105 (OpenLDAP) - Directory services</li> <li>VM-104 (MkDocs) - Documentation (can be created anytime)</li> </ol>"},{"location":"02-vm-creation/01-overview/#alternative-create-all-at-once","title":"Alternative: Create All at Once","text":"<p>You can also create all VMs in one session, then install Ubuntu on each sequentially.</p>"},{"location":"02-vm-creation/01-overview/#verification-checklist","title":"Verification Checklist","text":"<p>Before proceeding to individual VM creation:</p> <ul> <li>[ ] Ubuntu 24.04 LTS ISO uploaded to Proxmox</li> <li>[ ] IP address plan documented</li> <li>[ ] Sufficient storage space in ZFS pool (minimum 130GB total)</li> <li>[ ] Network bridge <code>vmbr0</code> configured</li> <li>[ ] Proxmox Web UI accessible</li> </ul>"},{"location":"02-vm-creation/01-overview/#time-estimate","title":"Time Estimate","text":"<ul> <li>Planning: 15-30 minutes</li> <li>Creating all VMs: 2-3 hours</li> <li>Installing Ubuntu on each: 2-3 hours</li> <li>Total Day 2: 4-5 hours</li> </ul>"},{"location":"02-vm-creation/01-overview/#common-issues","title":"Common Issues","text":""},{"location":"02-vm-creation/01-overview/#issue-not-enough-storage-space","title":"Issue: Not enough storage space","text":"<p>Solution: Check ZFS pool capacity: <pre><code>zpool list\n</code></pre></p>"},{"location":"02-vm-creation/01-overview/#issue-cannot-upload-iso","title":"Issue: Cannot upload ISO","text":"<p>Solution:  - Verify storage location has enough space - Try alternative upload method via command line - Check browser console for errors</p>"},{"location":"02-vm-creation/01-overview/#issue-network-bridge-not-configured","title":"Issue: Network bridge not configured","text":"<p>Solution:  - Proxmox creates <code>vmbr0</code> by default - If missing, check network configuration in Datacenter \u2192 Node \u2192 Network</p>"},{"location":"02-vm-creation/01-overview/#next-steps","title":"Next Steps","text":"<p>Choose your first VM to create: - Rocket.Chat VM - VM-101 - Nextcloud VM - VM-102 - Nginx Proxy VM - VM-103 - MkDocs VM - VM-104 - LDAP VM - VM-105 - Keycloak VM - VM-106</p> <p>Or create all VMs following the same pattern for each.</p>"},{"location":"02-vm-creation/02-rocketchat-vm/","title":"Rocket.Chat VM Creation (VM-101)","text":"<p>Brief description: Create VM-101 for Rocket.Chat with 2 vCPU, 4GB RAM, and 30GB storage.</p>"},{"location":"02-vm-creation/02-rocketchat-vm/#vm-specifications","title":"VM Specifications","text":"<ul> <li>VM ID: 101</li> <li>Name: rocketchat</li> <li>CPU: 2 vCPU</li> <li>RAM: 4 GiB</li> <li>Disk: 30 GiB (ZFS)</li> <li>OS: Ubuntu Server 24.04 LTS</li> <li>Network: vmbr0</li> <li>Purpose: Rocket.Chat server</li> </ul>"},{"location":"02-vm-creation/02-rocketchat-vm/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Proxmox Web UI accessible</li> <li>[ ] Ubuntu 24.04 LTS ISO uploaded</li> <li>[ ] ZFS storage pool available</li> <li>[ ] IP address planned from overview</li> </ul>"},{"location":"02-vm-creation/02-rocketchat-vm/#step-by-step-instructions","title":"Step-by-Step Instructions","text":""},{"location":"02-vm-creation/02-rocketchat-vm/#step-1-create-vm-in-proxmox","title":"Step 1: Create VM in Proxmox","text":"<ol> <li>Log into Proxmox Web UI at <code>https://&lt;proxmox-ip&gt;:8006</code></li> <li>Click on your node in the left sidebar</li> <li>Click Create VM button (top right)</li> </ol>"},{"location":"02-vm-creation/02-rocketchat-vm/#step-2-general-tab","title":"Step 2: General Tab","text":"<ul> <li>Node: (your node name)</li> <li>VM ID: 101</li> <li>Name: rocketchat</li> <li>Start at boot: (optional, can enable later)</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/02-rocketchat-vm/#step-3-os-tab","title":"Step 3: OS Tab","text":"<ul> <li>Storage: local</li> <li>ISO image: ubuntu-24.04-live-server-amd64.iso</li> <li>Type: Linux</li> <li>Version: 6.x - 2.6 Kernel</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/02-rocketchat-vm/#step-4-system-tab","title":"Step 4: System Tab","text":"<ul> <li>Graphic card: Default (SPICE)</li> <li>Machine: Default (i440fx)</li> <li>BIOS: Default (SeaBIOS)</li> <li>SCSI Controller: VirtIO SCSI</li> <li>Qemu Agent: (optional, can enable later)</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/02-rocketchat-vm/#step-5-disks-tab","title":"Step 5: Disks Tab","text":"<ul> <li>Storage: rpool</li> <li>Disk size (GiB): 30</li> <li>Format: Qemu image format (qcow2)</li> <li>Cache: Write back</li> <li>Discard: (optional, for SSD optimization)</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/02-rocketchat-vm/#step-6-cpu-tab","title":"Step 6: CPU Tab","text":"<ul> <li>Sockets: 1</li> <li>Cores: 2</li> <li>Type: Default (kvm64)</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/02-rocketchat-vm/#step-7-memory-tab","title":"Step 7: Memory Tab","text":"<ul> <li>Memory (MiB): 4096</li> <li>Ballooning Device: (optional)</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/02-rocketchat-vm/#step-8-network-tab","title":"Step 8: Network Tab","text":"<ul> <li>Bridge: vmbr0</li> <li>VLAN Tag: (none)</li> <li>Firewall: (unchecked for now)</li> <li>Model: VirtIO (paravirtualized)</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/02-rocketchat-vm/#step-9-confirm-tab","title":"Step 9: Confirm Tab","text":"<p>Review settings: - Name: rocketchat - VM ID: 101 - CPU: 2 cores - Memory: 4096 MiB - Disk: 30 GiB on rpool - Network: vmbr0</p> <p>Click Finish</p>"},{"location":"02-vm-creation/02-rocketchat-vm/#step-10-start-vm-and-install-ubuntu","title":"Step 10: Start VM and Install Ubuntu","text":"<ol> <li>Select VM 101 from the list</li> <li>Click Start button</li> <li>Click Console to open VNC viewer</li> <li>Press Enter to boot from ISO</li> </ol>"},{"location":"02-vm-creation/02-rocketchat-vm/#step-11-ubuntu-installation","title":"Step 11: Ubuntu Installation","text":"<p>Follow the Ubuntu Server installation wizard:</p> <p>Language: English</p> <p>Keyboard Layout: Your preferred layout</p> <p>Network Configuration: - DHCP should assign an IP automatically - Record this IP address for later use - Will be in format: 10.0.0.xxx</p> <p>Proxy: Leave blank (unless required)</p> <p>Mirror: Default is fine</p> <p>Storage: - Use entire disk - Accept default partitioning</p> <p>Profile: - Your name: Administrator - Server name: rocketchat - Username: admin - Password: [choose strong password] - Confirm password</p> <p>SSH: - [x] Install OpenSSH server - [ ] Import SSH identity (skip for now)</p> <p>Featured Server Snaps: - Skip all (we'll install manually)</p> <p>Complete Installation: - Wait for installation to finish - Remove installation medium (Proxmox will handle this) - Reboot</p>"},{"location":"02-vm-creation/02-rocketchat-vm/#step-12-post-installation","title":"Step 12: Post-Installation","text":"<p>After reboot:</p> <ol> <li>VM will boot from hard disk</li> <li>Login with your created user</li> <li>Verify IP address:    <pre><code>ip addr show\n</code></pre></li> <li>Test connectivity:    <pre><code>ping google.com\n</code></pre></li> <li>Update system:    <pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y\n</code></pre></li> </ol>"},{"location":"02-vm-creation/02-rocketchat-vm/#step-13-document-ip-address","title":"Step 13: Document IP Address","text":"<p>Record IP Address</p> <p>Write down the assigned IP address. You will need it for: - Nginx reverse proxy configuration - Monitoring setup - SSH access</p> <p>Add to your IP inventory table: <pre><code>rocket-chat | 101 | 10.0.0.101 | chat.example.com | Rocket.Chat Port 3000\n</code></pre></p>"},{"location":"02-vm-creation/02-rocketchat-vm/#verification","title":"Verification","text":"<ul> <li>[ ] VM 101 created with correct specifications</li> <li>[ ] Ubuntu 24.04 LTS installed</li> <li>[ ] Can login via console</li> <li>[ ] IP address assigned via DHCP</li> <li>[ ] Internet connectivity confirmed</li> <li>[ ] System updated</li> <li>[ ] IP address documented</li> </ul>"},{"location":"02-vm-creation/02-rocketchat-vm/#post-creation-configuration","title":"Post-Creation Configuration","text":""},{"location":"02-vm-creation/02-rocketchat-vm/#disable-ipv6-optional","title":"Disable IPv6 (Optional)","text":"<p>If not using IPv6:</p> <pre><code>sudo nano /etc/sysctl.conf\n</code></pre> <p>Add: <pre><code>net.ipv6.conf.all.disable_ipv6 = 1\nnet.ipv6.conf.default.disable_ipv6 = 1\nnet.ipv6.conf.lo.disable_ipv6 = 1\n</code></pre></p> <p>Apply: <pre><code>sudo sysctl -p\n</code></pre></p>"},{"location":"02-vm-creation/02-rocketchat-vm/#set-static-ip-optional","title":"Set Static IP (Optional)","text":"<p>If you want to set a static IP instead of DHCP:</p> <pre><code>sudo nano /etc/netplan/00-installer-config.yaml\n</code></pre> <p>Edit to: <pre><code>network:\n  version: 2\n  ethernets:\n    ens18:\n      dhcp4: no\n      addresses:\n        - 10.0.0.101/24\n      routes:\n        - to: default\n          via: 10.0.0.1\n      nameservers:\n        addresses:\n          - 8.8.8.8\n          - 1.1.1.1\n</code></pre></p> <p>Apply: <pre><code>sudo netplan apply\n</code></pre></p>"},{"location":"02-vm-creation/02-rocketchat-vm/#common-issues","title":"Common Issues","text":""},{"location":"02-vm-creation/02-rocketchat-vm/#issue-vm-wont-start","title":"Issue: VM won't start","text":"<p>Solution: Check Proxmox logs: Datacenter \u2192 Node \u2192 Shell \u2192 <code>cat /var/log/syslog | grep 101</code></p>"},{"location":"02-vm-creation/02-rocketchat-vm/#issue-cannot-access-console","title":"Issue: Cannot access console","text":"<p>Solution: Try different browser or disable browser extensions blocking WebSocket</p>"},{"location":"02-vm-creation/02-rocketchat-vm/#issue-network-not-working","title":"Issue: Network not working","text":"<p>Solution:  <pre><code>sudo ip link set ens18 up\nsudo dhclient ens18\n</code></pre></p>"},{"location":"02-vm-creation/02-rocketchat-vm/#issue-installation-freezes","title":"Issue: Installation freezes","text":"<p>Solution: Increase VM memory temporarily to 6GB during install, reduce after</p>"},{"location":"02-vm-creation/02-rocketchat-vm/#next-steps","title":"Next Steps","text":"<p>Proceed to: - Nextcloud VM - VM-102 - Or Rocket.Chat Installation if all VMs created</p>"},{"location":"02-vm-creation/03-nextcloud-vm/","title":"Nextcloud VM Creation (VM-102)","text":"<p>Brief description: Create VM-102 for Nextcloud with 2 vCPU, 6GB RAM, and 50GB storage.</p>"},{"location":"02-vm-creation/03-nextcloud-vm/#vm-specifications","title":"VM Specifications","text":"<ul> <li>VM ID: 102</li> <li>Name: nextcloud</li> <li>CPU: 2 vCPU</li> <li>RAM: 6 GiB (6144 MiB)</li> <li>Disk: 50 GiB (ZFS)</li> <li>OS: Ubuntu Server 24.04 LTS</li> <li>Network: vmbr0</li> <li>Purpose: Nextcloud file sync and share</li> </ul>"},{"location":"02-vm-creation/03-nextcloud-vm/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Proxmox Web UI accessible</li> <li>[ ] Ubuntu 24.04 LTS ISO available</li> <li>[ ] ZFS storage pool available</li> <li>[ ] IP address planned from overview</li> </ul>"},{"location":"02-vm-creation/03-nextcloud-vm/#step-by-step-instructions","title":"Step-by-Step Instructions","text":""},{"location":"02-vm-creation/03-nextcloud-vm/#step-1-create-vm-in-proxmox","title":"Step 1: Create VM in Proxmox","text":"<ol> <li>In Proxmox Web UI, select your node</li> <li>Click Create VM button</li> </ol>"},{"location":"02-vm-creation/03-nextcloud-vm/#step-2-general-tab","title":"Step 2: General Tab","text":"<ul> <li>VM ID: 102</li> <li>Name: nextcloud</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/03-nextcloud-vm/#step-3-os-tab","title":"Step 3: OS Tab","text":"<ul> <li>ISO image: ubuntu-24.04-live-server-amd64.iso</li> <li>Type: Linux</li> <li>Version: 6.x - 2.6 Kernel</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/03-nextcloud-vm/#step-4-system-tab","title":"Step 4: System Tab","text":"<ul> <li>Graphic card: Default</li> <li>SCSI Controller: VirtIO SCSI</li> <li>Accept other defaults</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/03-nextcloud-vm/#step-5-disks-tab","title":"Step 5: Disks Tab","text":"<ul> <li>Storage: rpool</li> <li>Disk size (GiB): 50</li> <li>Format: qcow2</li> <li>Cache: Write back</li> </ul> <p>Storage Consideration</p> <p>Nextcloud requires more storage than other VMs because user files will be stored here. 50GB provides room for initial use and growth.</p> <p>Click Next</p>"},{"location":"02-vm-creation/03-nextcloud-vm/#step-6-cpu-tab","title":"Step 6: CPU Tab","text":"<ul> <li>Sockets: 1</li> <li>Cores: 2</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/03-nextcloud-vm/#step-7-memory-tab","title":"Step 7: Memory Tab","text":"<ul> <li>Memory (MiB): 6146</li> <li>Ballooning Device: Optional</li> </ul> <p>Memory Requirements</p> <p>Nextcloud benefits from extra RAM for file caching and database operations. 6GB provides good performance for 10-50 users.</p> <p>Click Next</p>"},{"location":"02-vm-creation/03-nextcloud-vm/#step-8-network-tab","title":"Step 8: Network Tab","text":"<ul> <li>Bridge: vmbr0</li> <li>Model: VirtIO (paravirtualized)</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/03-nextcloud-vm/#step-9-confirm","title":"Step 9: Confirm","text":"<p>Review settings: - Name: nextcloud - VM ID: 102 - CPU: 2 cores - Memory: 6144 MiB - Disk: 50 GiB on rpool</p> <p>Click Finish</p>"},{"location":"02-vm-creation/03-nextcloud-vm/#step-10-install-ubuntu","title":"Step 10: Install Ubuntu","text":"<ol> <li>Start VM 102</li> <li>Open Console</li> <li>Boot from ISO</li> </ol>"},{"location":"02-vm-creation/03-nextcloud-vm/#step-11-ubuntu-installation-wizard","title":"Step 11: Ubuntu Installation Wizard","text":"<p>Language: English</p> <p>Keyboard Layout: Your layout</p> <p>Network Configuration: - DHCP will assign IP - Record this IP address - Format: 10.0.0.xxx</p> <p>Proxy: (none)</p> <p>Mirror: Default</p> <p>Storage: - Use entire disk - Accept defaults</p> <p>Profile: - Your name: Administrator - Server name: nextcloud - Username: admin - Password: [strong password] - Confirm password</p> <p>SSH: - [x] Install OpenSSH server</p> <p>Server Snaps: Skip all</p> <p>Complete and reboot</p>"},{"location":"02-vm-creation/03-nextcloud-vm/#step-12-post-installation","title":"Step 12: Post-Installation","text":"<p>After reboot:</p> <ol> <li>Login as your user</li> <li>Check IP address:    <pre><code>ip addr show\n</code></pre></li> <li>Verify connectivity:    <pre><code>ping google.com\n</code></pre></li> <li>Update system:    <pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y\n</code></pre></li> </ol>"},{"location":"02-vm-creation/03-nextcloud-vm/#step-13-record-ip-address","title":"Step 13: Record IP Address","text":"<p>Update IP Inventory</p> <p>Add the IP address to your documentation: <pre><code>nextcloud | 102 | 10.0.0.102 | cloud.example.com | Nextcloud Port 80/443\n</code></pre></p>"},{"location":"02-vm-creation/03-nextcloud-vm/#verification","title":"Verification","text":"<ul> <li>[ ] VM 102 created with correct specs</li> <li>[ ] Ubuntu 24.04 LTS installed</li> <li>[ ] Console access working</li> <li>[ ] IP address assigned</li> <li>[ ] Internet connectivity verified</li> <li>[ ] System packages updated</li> <li>[ ] IP address documented</li> </ul>"},{"location":"02-vm-creation/03-nextcloud-vm/#optimization-for-nextcloud","title":"Optimization for Nextcloud","text":""},{"location":"02-vm-creation/03-nextcloud-vm/#create-additional-storage-optional","title":"Create Additional Storage (Optional)","text":"<p>If you want to separate Nextcloud data:</p> <ol> <li>In Proxmox, add additional disk to VM 102:</li> <li>Hardware \u2192 Add \u2192 Hard Disk</li> <li>Storage: rpool</li> <li>Size: 100GB or more</li> <li> <p>Format: qcow2</p> </li> <li> <p>In VM, format and mount:    <pre><code># Find new disk (likely /dev/sdb)\nlsblk\n\n# Format\nsudo mkfs.ext4 /dev/sdb\n\n# Create mount point\nsudo mkdir /mnt/nextcloud-data\n\n# Mount\nsudo mount /dev/sdb /mnt/nextcloud-data\n\n# Add to fstab\necho '/dev/sdb /mnt/nextcloud-data ext4 defaults 0 2' | sudo tee -a /etc/fstab\n</code></pre></p> </li> </ol>"},{"location":"02-vm-creation/03-nextcloud-vm/#enable-swap-optional","title":"Enable Swap (Optional)","text":"<p>For systems with limited RAM:</p> <pre><code># Create 2GB swap file\nsudo fallocate -l 2G /swapfile\nsudo chmod 600 /swapfile\nsudo mkswap /swapfile\nsudo swapon /swapfile\n\n# Add to fstab\necho '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab\n</code></pre>"},{"location":"02-vm-creation/03-nextcloud-vm/#common-issues","title":"Common Issues","text":""},{"location":"02-vm-creation/03-nextcloud-vm/#issue-disk-space-warning-during-install","title":"Issue: Disk space warning during install","text":"<p>Solution: 50GB is sufficient for base install. If you need more space, shutdown VM and expand disk in Proxmox before installing Nextcloud.</p>"},{"location":"02-vm-creation/03-nextcloud-vm/#issue-slow-performance-during-install","title":"Issue: Slow performance during install","text":"<p>Solution: This is normal. Nextcloud VM creation is identical to other VMs. Performance optimization comes later during Nextcloud installation.</p>"},{"location":"02-vm-creation/03-nextcloud-vm/#issue-cannot-boot-after-installation","title":"Issue: Cannot boot after installation","text":"<p>Solution: Check boot order in VM options. Ensure hard disk is first in boot sequence.</p>"},{"location":"02-vm-creation/03-nextcloud-vm/#next-steps","title":"Next Steps","text":"<p>Proceed to: - Nginx Proxy VM - VM-103 - Or continue with Nextcloud Installation</p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/","title":"Nginx Proxy VM Creation (VM-103)","text":"<p>Brief description: Create VM-103 for Nginx reverse proxy with 1 vCPU, 2GB RAM, and 10GB storage.</p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#vm-specifications","title":"VM Specifications","text":"<ul> <li>VM ID: 103</li> <li>Name: nginx-proxy</li> <li>CPU: 1 vCPU</li> <li>RAM: 2 GiB</li> <li>Disk: 10 GiB (ZFS)</li> <li>OS: Ubuntu Server 24.04 LTS</li> <li>Network: vmbr0</li> <li>Purpose: Reverse proxy and SSL termination</li> </ul>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Proxmox Web UI accessible</li> <li>[ ] Ubuntu 24.04 LTS ISO available</li> <li>[ ] ZFS storage pool available</li> <li>[ ] IP address planned</li> </ul>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#step-by-step-instructions","title":"Step-by-Step Instructions","text":""},{"location":"02-vm-creation/04-nginx-proxy-vm/#step-1-create-vm-in-proxmox","title":"Step 1: Create VM in Proxmox","text":"<ol> <li>Click Create VM in Proxmox UI</li> </ol>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#step-2-general-tab","title":"Step 2: General Tab","text":"<ul> <li>VM ID: 103</li> <li>Name: nginx-proxy</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#step-3-os-tab","title":"Step 3: OS Tab","text":"<ul> <li>ISO image: ubuntu-24.04-live-server-amd64.iso</li> <li>Type: Linux</li> <li>Version: 6.x - 2.6 Kernel</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#step-4-system-tab","title":"Step 4: System Tab","text":"<p>Accept defaults</p> <p>Click Next</p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#step-5-disks-tab","title":"Step 5: Disks Tab","text":"<ul> <li>Storage: rpool</li> <li>Disk size (GiB): 10</li> <li>Format: qcow2</li> <li>Cache: Write back</li> </ul> <p>Minimal Storage</p> <p>Nginx proxy requires minimal storage as it only handles configuration files and certificates. 10GB is sufficient.</p> <p>Click Next</p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#step-6-cpu-tab","title":"Step 6: CPU Tab","text":"<ul> <li>Sockets: 1</li> <li>Cores: 1</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#step-7-memory-tab","title":"Step 7: Memory Tab","text":"<ul> <li>Memory (MiB): 2048</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#step-8-network-tab","title":"Step 8: Network Tab","text":"<ul> <li>Bridge: vmbr0</li> <li>Model: VirtIO</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#step-9-confirm","title":"Step 9: Confirm","text":"<p>Review: - Name: nginx-proxy - VM ID: 103 - CPU: 1 core - Memory: 2048 MiB - Disk: 10 GiB</p> <p>Click Finish</p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#step-10-install-ubuntu","title":"Step 10: Install Ubuntu","text":"<ol> <li>Start VM 103</li> <li>Open Console</li> <li>Boot from ISO</li> <li>Follow installation wizard:</li> </ol> <p>Network: Record assigned IP</p> <p>Profile: - Server name: nginx-proxy - Username: admin - Password: [strong password]</p> <p>SSH: Install OpenSSH server</p> <p>Complete and reboot</p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#step-11-post-installation","title":"Step 11: Post-Installation","text":"<p>After reboot:</p> <pre><code># Check IP\nip addr show\n\n# Update system\nsudo apt update &amp;&amp; sudo apt upgrade -y\n\n# Install essential tools\nsudo apt install -y curl vim htop\n</code></pre>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#step-12-document-ip","title":"Step 12: Document IP","text":"<p>Add to inventory: <pre><code>nginx-proxy | 103 | 10.0.0.103 | proxy.example.com | Nginx Port 80/443\n</code></pre></p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#verification","title":"Verification","text":"<ul> <li>[ ] VM 103 created with correct specs</li> <li>[ ] Ubuntu installed</li> <li>[ ] IP address assigned and recorded</li> <li>[ ] System updated</li> <li>[ ] SSH accessible</li> </ul>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#special-configuration","title":"Special Configuration","text":""},{"location":"02-vm-creation/04-nginx-proxy-vm/#enable-ip-forwarding","title":"Enable IP Forwarding","text":"<p>For proper reverse proxy functionality:</p> <pre><code># Edit sysctl\nsudo nano /etc/sysctl.conf\n</code></pre> <p>Uncomment or add: <pre><code>net.ipv4.ip_forward=1\n</code></pre></p> <p>Apply: <pre><code>sudo sysctl -p\n</code></pre></p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#common-issues","title":"Common Issues","text":""},{"location":"02-vm-creation/04-nginx-proxy-vm/#issue-low-resource-warnings","title":"Issue: Low resource warnings","text":"<p>Solution: Nginx proxy runs fine with 1 vCPU and 2GB RAM. These warnings can be ignored.</p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#issue-cannot-reach-backend-services","title":"Issue: Cannot reach backend services","text":"<p>Solution: Ensure IP forwarding is enabled and firewall allows forwarding.</p>"},{"location":"02-vm-creation/04-nginx-proxy-vm/#next-steps","title":"Next Steps","text":"<ul> <li>MkDocs VM - VM-104</li> <li>Or Nginx Installation</li> </ul>"},{"location":"02-vm-creation/05-mkdocs-vm/","title":"MkDocs VM Creation (VM-104)","text":"<p>Brief description: Create VM-104 for MkDocs documentation server with 1 vCPU, 2GB RAM, and 10GB storage.</p>"},{"location":"02-vm-creation/05-mkdocs-vm/#vm-specifications","title":"VM Specifications","text":"<ul> <li>VM ID: 104</li> <li>Name: mkdocs</li> <li>CPU: 1 vCPU</li> <li>RAM: 2 GiB</li> <li>Disk: 10 GiB (ZFS)</li> <li>OS: Ubuntu Server 24.04 LTS</li> <li>Network: vmbr0</li> <li>Purpose: Documentation server (MkDocs)</li> </ul>"},{"location":"02-vm-creation/05-mkdocs-vm/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Proxmox Web UI accessible</li> <li>[ ] Ubuntu 24.04 LTS ISO available</li> <li>[ ] ZFS storage pool available</li> </ul>"},{"location":"02-vm-creation/05-mkdocs-vm/#step-by-step-instructions","title":"Step-by-Step Instructions","text":""},{"location":"02-vm-creation/05-mkdocs-vm/#step-1-create-vm","title":"Step 1: Create VM","text":"<ol> <li>Create VM in Proxmox UI</li> </ol>"},{"location":"02-vm-creation/05-mkdocs-vm/#step-2-general","title":"Step 2: General","text":"<ul> <li>VM ID: 104</li> <li>Name: mkdocs</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/05-mkdocs-vm/#step-3-os","title":"Step 3: OS","text":"<ul> <li>ISO image: ubuntu-24.04-live-server-amd64.iso</li> <li>Type: Linux</li> <li>Version: 6.x - 2.6 Kernel</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/05-mkdocs-vm/#step-4-system","title":"Step 4: System","text":"<p>Accept defaults</p> <p>Click Next</p>"},{"location":"02-vm-creation/05-mkdocs-vm/#step-5-disks","title":"Step 5: Disks","text":"<ul> <li>Storage: rpool</li> <li>Disk size: 10 GiB</li> <li>Format: qcow2</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/05-mkdocs-vm/#step-6-cpu","title":"Step 6: CPU","text":"<ul> <li>Cores: 1</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/05-mkdocs-vm/#step-7-memory","title":"Step 7: Memory","text":"<ul> <li>Memory: 2048 MiB</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/05-mkdocs-vm/#step-8-network","title":"Step 8: Network","text":"<ul> <li>Bridge: vmbr0</li> <li>Model: VirtIO</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/05-mkdocs-vm/#step-9-confirm","title":"Step 9: Confirm","text":"<p>Review and click Finish</p>"},{"location":"02-vm-creation/05-mkdocs-vm/#step-10-install-ubuntu","title":"Step 10: Install Ubuntu","text":"<ol> <li>Start VM 104</li> <li>Open Console</li> <li>Install Ubuntu:</li> </ol> <p>Network: Record IP address</p> <p>Profile: - Server name: mkdocs - Username: admin - Password: [strong password]</p> <p>SSH: Install OpenSSH server</p> <p>Complete installation</p>"},{"location":"02-vm-creation/05-mkdocs-vm/#step-11-post-installation","title":"Step 11: Post-Installation","text":"<pre><code># Update\nsudo apt update &amp;&amp; sudo apt upgrade -y\n\n# Install Python and Git\nsudo apt install -y python3 python3-pip python3-venv git\n\n# Check versions\npython3 --version\npip3 --version\ngit --version\n</code></pre>"},{"location":"02-vm-creation/05-mkdocs-vm/#step-12-document-ip","title":"Step 12: Document IP","text":"<p>Add to inventory: <pre><code>mkdocs | 104 | 10.0.0.104 | docs.example.com | MkDocs Port 8000\n</code></pre></p>"},{"location":"02-vm-creation/05-mkdocs-vm/#verification","title":"Verification","text":"<ul> <li>[ ] VM 104 created</li> <li>[ ] Ubuntu installed</li> <li>[ ] Python and Git installed</li> <li>[ ] IP address recorded</li> </ul>"},{"location":"02-vm-creation/05-mkdocs-vm/#next-steps","title":"Next Steps","text":"<ul> <li>LDAP VM - VM-105</li> <li>Or MkDocs Setup Guide</li> </ul>"},{"location":"02-vm-creation/06-ldap-vm/","title":"OpenLDAP VM Creation (VM-105)","text":"<p>Brief description: Create VM-105 for OpenLDAP directory server with 1 vCPU, 2GB RAM, and 10GB storage.</p>"},{"location":"02-vm-creation/06-ldap-vm/#vm-specifications","title":"VM Specifications","text":"<ul> <li>VM ID: 105</li> <li>Name: openldap</li> <li>CPU: 1 vCPU</li> <li>RAM: 2 GiB</li> <li>Disk: 10 GiB (ZFS)</li> <li>OS: Ubuntu Server 24.04 LTS</li> <li>Network: vmbr0</li> <li>Purpose: LDAP directory services</li> </ul>"},{"location":"02-vm-creation/06-ldap-vm/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Proxmox Web UI accessible</li> <li>[ ] Ubuntu 24.04 LTS ISO available</li> <li>[ ] ZFS storage pool available</li> </ul>"},{"location":"02-vm-creation/06-ldap-vm/#step-by-step-instructions","title":"Step-by-Step Instructions","text":""},{"location":"02-vm-creation/06-ldap-vm/#step-1-create-vm","title":"Step 1: Create VM","text":"<p>Click Create VM in Proxmox</p>"},{"location":"02-vm-creation/06-ldap-vm/#step-2-general","title":"Step 2: General","text":"<ul> <li>VM ID: 105</li> <li>Name: openldap</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/06-ldap-vm/#step-3-os","title":"Step 3: OS","text":"<ul> <li>ISO image: ubuntu-24.04-live-server-amd64.iso</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/06-ldap-vm/#step-4-system","title":"Step 4: System","text":"<p>Accept defaults</p> <p>Click Next</p>"},{"location":"02-vm-creation/06-ldap-vm/#step-5-disks","title":"Step 5: Disks","text":"<ul> <li>Storage: rpool</li> <li>Disk size: 10 GiB</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/06-ldap-vm/#step-6-cpu","title":"Step 6: CPU","text":"<ul> <li>Cores: 1</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/06-ldap-vm/#step-7-memory","title":"Step 7: Memory","text":"<ul> <li>Memory: 2048 MiB</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/06-ldap-vm/#step-8-network","title":"Step 8: Network","text":"<ul> <li>Bridge: vmbr0</li> <li>Model: VirtIO</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/06-ldap-vm/#step-9-confirm","title":"Step 9: Confirm","text":"<p>Click Finish</p>"},{"location":"02-vm-creation/06-ldap-vm/#step-10-install-ubuntu","title":"Step 10: Install Ubuntu","text":"<ol> <li>Start VM 105</li> <li>Open Console</li> <li>Install Ubuntu:</li> </ol> <p>Network: Record IP</p> <p>Profile: - Server name: openldap - Username: admin - Password: [strong password]</p> <p>SSH: Install OpenSSH server</p> <p>Complete installation</p>"},{"location":"02-vm-creation/06-ldap-vm/#step-11-post-installation","title":"Step 11: Post-Installation","text":"<pre><code># Update system\nsudo apt update &amp;&amp; sudo apt upgrade -y\n\n# Install LDAP utilities\nsudo apt install -y ldap-utils\n</code></pre>"},{"location":"02-vm-creation/06-ldap-vm/#step-12-document-ip","title":"Step 12: Document IP","text":"<p>Add to inventory: <pre><code>openldap | 105 | 10.0.0.105 | ldap.example.com | LDAP Port 389/636\n</code></pre></p>"},{"location":"02-vm-creation/06-ldap-vm/#verification","title":"Verification","text":"<ul> <li>[ ] VM 105 created</li> <li>[ ] Ubuntu installed</li> <li>[ ] IP address assigned</li> <li>[ ] System updated</li> </ul>"},{"location":"02-vm-creation/06-ldap-vm/#security-note","title":"Security Note","text":"<p>LDAP Security</p> <p>This VM will store user credentials. Ensure proper firewall rules are configured (only Keycloak should access LDAP ports).</p>"},{"location":"02-vm-creation/06-ldap-vm/#next-steps","title":"Next Steps","text":"<ul> <li>Keycloak VM - VM-106</li> <li>Or OpenLDAP Installation</li> </ul>"},{"location":"02-vm-creation/07-keycloak-vm/","title":"Keycloak VM Creation (VM-106)","text":"<p>Brief description: Create VM-106 for Keycloak SSO server with 2 vCPU, 4GB RAM, and 20GB storage.</p>"},{"location":"02-vm-creation/07-keycloak-vm/#vm-specifications","title":"VM Specifications","text":"<ul> <li>VM ID: 106</li> <li>Name: keycloak</li> <li>CPU: 2 vCPU</li> <li>RAM: 4 GiB</li> <li>Disk: 20 GiB (ZFS)</li> <li>OS: Ubuntu Server 24.04 LTS</li> <li>Network: vmbr0</li> <li>Purpose: SSO and Identity Provider (IdP)</li> </ul>"},{"location":"02-vm-creation/07-keycloak-vm/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Proxmox Web UI accessible</li> <li>[ ] Ubuntu 24.04 LTS ISO available</li> <li>[ ] ZFS storage pool available</li> </ul>"},{"location":"02-vm-creation/07-keycloak-vm/#step-by-step-instructions","title":"Step-by-Step Instructions","text":""},{"location":"02-vm-creation/07-keycloak-vm/#step-1-create-vm","title":"Step 1: Create VM","text":"<p>Click Create VM in Proxmox UI</p>"},{"location":"02-vm-creation/07-keycloak-vm/#step-2-general","title":"Step 2: General","text":"<ul> <li>VM ID: 106</li> <li>Name: keycloak</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/07-keycloak-vm/#step-3-os","title":"Step 3: OS","text":"<ul> <li>ISO image: ubuntu-24.04-live-server-amd64.iso</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/07-keycloak-vm/#step-4-system","title":"Step 4: System","text":"<p>Accept defaults</p> <p>Click Next</p>"},{"location":"02-vm-creation/07-keycloak-vm/#step-5-disks","title":"Step 5: Disks","text":"<ul> <li>Storage: rpool</li> <li>Disk size: 20 GiB</li> <li>Format: qcow2</li> </ul> <p>Java Application Storage</p> <p>Keycloak requires Java and has additional libraries. 20GB provides comfortable space for the application and logs.</p> <p>Click Next</p>"},{"location":"02-vm-creation/07-keycloak-vm/#step-6-cpu","title":"Step 6: CPU","text":"<ul> <li>Sockets: 1</li> <li>Cores: 2</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/07-keycloak-vm/#step-7-memory","title":"Step 7: Memory","text":"<ul> <li>Memory: 4096 MiB</li> </ul> <p>Java Memory Requirements</p> <p>Keycloak runs on Java and benefits from 4GB RAM for optimal performance, especially with LDAP integration.</p> <p>Click Next</p>"},{"location":"02-vm-creation/07-keycloak-vm/#step-8-network","title":"Step 8: Network","text":"<ul> <li>Bridge: vmbr0</li> <li>Model: VirtIO</li> </ul> <p>Click Next</p>"},{"location":"02-vm-creation/07-keycloak-vm/#step-9-confirm","title":"Step 9: Confirm","text":"<p>Review: - Name: keycloak - VM ID: 106 - CPU: 2 cores - Memory: 4096 MiB - Disk: 20 GiB</p> <p>Click Finish</p>"},{"location":"02-vm-creation/07-keycloak-vm/#step-10-install-ubuntu","title":"Step 10: Install Ubuntu","text":"<ol> <li>Start VM 106</li> <li>Open Console</li> <li>Install Ubuntu:</li> </ol> <p>Network: Record IP address</p> <p>Profile: - Server name: keycloak - Username: admin - Password: [strong password]</p> <p>SSH: Install OpenSSH server</p> <p>Complete installation</p>"},{"location":"02-vm-creation/07-keycloak-vm/#step-11-post-installation","title":"Step 11: Post-Installation","text":"<pre><code># Update system\nsudo apt update &amp;&amp; sudo apt upgrade -y\n\n# Install Java (required for Keycloak)\nsudo apt install -y openjdk-17-jdk\n\n# Verify Java installation\njava -version\n</code></pre> <p>Expected output: <pre><code>openjdk version \"17.0.x\" 202x-xx-xx\nOpenJDK Runtime Environment (build 17.0.x+xx-Ubuntu-xx)\nOpenJDK 64-Bit Server VM (build 17.0.x+xx-Ubuntu-xx, mixed mode, sharing)\n</code></pre></p>"},{"location":"02-vm-creation/07-keycloak-vm/#step-12-document-ip","title":"Step 12: Document IP","text":"<p>Add to inventory: <pre><code>keycloak | 106 | 10.0.0.106 | auth.example.com | Keycloak Port 8080\n</code></pre></p>"},{"location":"02-vm-creation/07-keycloak-vm/#verification","title":"Verification","text":"<ul> <li>[ ] VM 106 created with correct specs</li> <li>[ ] Ubuntu 24.04 LTS installed</li> <li>[ ] OpenJDK 17 installed</li> <li>[ ] IP address assigned and recorded</li> <li>[ ] System updated</li> </ul>"},{"location":"02-vm-creation/07-keycloak-vm/#common-issues","title":"Common Issues","text":""},{"location":"02-vm-creation/07-keycloak-vm/#issue-java-not-found-after-installation","title":"Issue: Java not found after installation","text":"<p>Solution:  <pre><code>sudo update-alternatives --config java\n# Select the correct Java version\n</code></pre></p>"},{"location":"02-vm-creation/07-keycloak-vm/#issue-vm-runs-slowly-during-install","title":"Issue: VM runs slowly during install","text":"<p>Solution: Keycloak VM has adequate resources. Slowdowns during Ubuntu install are normal.</p>"},{"location":"02-vm-creation/07-keycloak-vm/#next-steps","title":"Next Steps","text":"<p>All VMs are now created! Proceed to software installation: - Rocket.Chat Installation - Nextcloud Installation - Nginx Installation - Keycloak &amp; OIDC</p> <p>Or return to VM Overview to verify all IPs are documented.</p>"},{"location":"03-software/01-rocketchat/","title":"Rocket.Chat Installation","text":"<p>Brief description: Install Rocket.Chat 6.x on VM-101 using Docker Compose.</p>"},{"location":"03-software/01-rocketchat/#what-youll-learn","title":"What You'll Learn","text":"<ul> <li>How to install Docker and Docker Compose</li> <li>How to configure Rocket.Chat with MongoDB</li> <li>How to verify the installation</li> </ul>"},{"location":"03-software/01-rocketchat/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] VM-101 created and Ubuntu 24.04 LTS installed</li> <li>[ ] IP address assigned and documented</li> <li>[ ] SSH access to VM-101 working</li> <li>[ ] 4GB RAM and 30GB disk available</li> </ul>"},{"location":"03-software/01-rocketchat/#estimated-time","title":"Estimated Time","text":"<p>3-4 hours</p>"},{"location":"03-software/01-rocketchat/#step-by-step-instructions","title":"Step-by-Step Instructions","text":""},{"location":"03-software/01-rocketchat/#step-1-ssh-to-rocketchat-vm","title":"Step 1: SSH to Rocket.Chat VM","text":"<pre><code>ssh admin@&lt;rocketchat-ip&gt;\n</code></pre>"},{"location":"03-software/01-rocketchat/#step-2-update-system","title":"Step 2: Update System","text":"<pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y\n</code></pre>"},{"location":"03-software/01-rocketchat/#step-3-install-docker","title":"Step 3: Install Docker","text":"<p>Install prerequisites:</p> <pre><code>sudo apt install -y apt-transport-https ca-certificates curl gnupg lsb-release\n</code></pre> <p>Add Docker GPG key:</p> <pre><code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n</code></pre> <p>Add Docker repository:</p> <pre><code>echo \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null\n</code></pre> <p>Install Docker:</p> <pre><code>sudo apt update\nsudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin\n</code></pre> <p>Verify installation:</p> <pre><code>docker --version\ndocker compose version\n</code></pre>"},{"location":"03-software/01-rocketchat/#step-4-add-user-to-docker-group","title":"Step 4: Add User to Docker Group","text":"<pre><code>sudo usermod -aG docker $USER\nnewgrp docker\n</code></pre>"},{"location":"03-software/01-rocketchat/#step-5-create-docker-compose-configuration","title":"Step 5: Create Docker Compose Configuration","text":"<p>Create directory:</p> <pre><code>mkdir -p ~/rocketchat\ncd ~/rocketchat\n</code></pre> <p>Create docker-compose.yml:</p> <p>```bash cat &gt; docker-compose.yml &lt;&lt; 'EOF' version: '3'</p> <p>services:   rocketchat:     image: rocketchat/rocket.chat:latest     restart: unless-stopped     volumes:       - ./uploads:/app/uploads     environment:       - PORT=3000       - ROOT_URL=http://localhost:3000       - MONGO_URL=mongodb://mongo:27017/rocketchat       - MONGO_OPLOG_URL=mongodb://mongo:27017/local     ports:       - 3000:3000     depends_on:       - mongo     networks:       - rocketchat-network</p> <p>mongo:     image: mongo:6.0     restart: unless-stopped     volumes:       - ./data/db:/data/db       - ./data/dump:/dump     command: mongod --oplogSize 128 --replSet rs0     networks:       - rocketchat-network</p> <p>mongo-init-replica:     image: mongo:6.0     command: &gt;       bash -c       \"for i in `seq 1 30`; do         mongo mongo/rocketchat --eval \\\"rs.initiate({           _id: 'rs0',           members: [ { _id: 0, host: 'mongo:27017' } ]})\\\" &amp;&amp;         s=\\$\\$? &amp;&amp; break || s=\\$\\$?;         echo \\\"Tried \\$\\$i times. Waiting 5 secs...\\\";         sleep 5;       done; (exit \\$\\$s)\"     depends_on:       - mongo     networks:       - rocketchat-network</p> <p>networks:   rocketchat-network:     driver: bridge</p>"},{"location":"03-software/02-nextcloud/","title":"Nextcloud Installation","text":"<p>Brief description: Install Nextcloud 28.x on VM-102 using Snap for quick deployment.</p>"},{"location":"03-software/02-nextcloud/#what-youll-learn","title":"What You'll Learn","text":"<ul> <li>How to install Nextcloud via Snap</li> <li>How to configure trusted domains</li> <li>How to verify the installation</li> </ul>"},{"location":"03-software/02-nextcloud/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] VM-102 created and Ubuntu 24.04 LTS installed</li> <li>[ ] IP address assigned and documented</li> <li>[ ] SSH access to VM-102 working</li> <li>[ ] 6GB RAM and 50GB disk available</li> </ul>"},{"location":"03-software/02-nextcloud/#estimated-time","title":"Estimated Time","text":"<p>3-4 hours</p>"},{"location":"03-software/02-nextcloud/#step-by-step-instructions","title":"Step-by-Step Instructions","text":""},{"location":"03-software/02-nextcloud/#step-1-ssh-to-nextcloud-vm","title":"Step 1: SSH to Nextcloud VM","text":"<pre><code>ssh admin@&lt;nextcloud-ip&gt;\n</code></pre>"},{"location":"03-software/02-nextcloud/#step-2-update-system","title":"Step 2: Update System","text":"<pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y\n</code></pre>"},{"location":"03-software/02-nextcloud/#step-3-install-snap","title":"Step 3: Install Snap","text":"<pre><code>sudo apt install -y snapd\n</code></pre> <p>Verify snap is installed:</p> <pre><code>snap version\n</code></pre>"},{"location":"03-software/02-nextcloud/#step-4-install-nextcloud","title":"Step 4: Install Nextcloud","text":"<pre><code>sudo snap install nextcloud\n</code></pre> <p>This will take 10-15 minutes. Monitor progress:</p> <pre><code>sudo snap changes\n</code></pre> <p>Wait until status shows \"Done\".</p>"},{"location":"03-software/02-nextcloud/#step-5-configure-trusted-domains","title":"Step 5: Configure Trusted Domains","text":"<p>Add your internal IP:</p> <pre><code>sudo nextcloud.occ config:system:set trusted_domains 1 --value=&lt;nextcloud-ip&gt;\n</code></pre> <p>Add your public domain (for later):</p> <pre><code>sudo nextcloud.occ config:system:set trusted_domains 2 --value=cloud.example.com\n</code></pre> <p>Verify configuration:</p> <pre><code>sudo nextcloud.occ config:system:get trusted_domains\n</code></pre> <p>Should show: <pre><code>localhost\n&lt;nextcloud-ip&gt;\ncloud.example.com\n</code></pre></p>"},{"location":"03-software/02-nextcloud/#step-6-create-admin-account","title":"Step 6: Create Admin Account","text":"<pre><code>sudo nextcloud.manual-install admin &lt;strong-password&gt;\n</code></pre> <p>Replace <code>&lt;strong-password&gt;</code> with a secure password.</p>"},{"location":"03-software/02-nextcloud/#step-7-verify-installation","title":"Step 7: Verify Installation","text":"<p>Check Nextcloud status:</p> <pre><code>sudo nextcloud.occ status\n</code></pre> <p>Expected output: <pre><code>  - installed: true\n  - version: 28.0.x.x\n  - versionstring: 28.0.x\n  - edition: \n</code></pre></p>"},{"location":"03-software/02-nextcloud/#step-8-configure-background-jobs","title":"Step 8: Configure Background Jobs","text":"<p>Set cron for background tasks:</p> <pre><code>sudo nextcloud.occ background:cron\n</code></pre> <p>Add cron job:</p> <pre><code>echo \"*/5 * * * * root /snap/bin/nextcloud.occ background:cron\" | sudo tee /etc/cron.d/nextcloud\n</code></pre>"},{"location":"03-software/02-nextcloud/#step-9-configure-memory-caching","title":"Step 9: Configure Memory Caching","text":"<p>Enable APCu for better performance:</p> <pre><code>sudo nextcloud.occ config:system:set memcache.local --value='\\OC\\Memcache\\APCu'\n</code></pre>"},{"location":"03-software/02-nextcloud/#step-10-adjust-php-memory-limit","title":"Step 10: Adjust PHP Memory Limit","text":"<pre><code>sudo snap set nextcloud php.memory-limit=512M\n</code></pre>"},{"location":"03-software/02-nextcloud/#step-11-test-web-access","title":"Step 11: Test Web Access","text":"<ol> <li> <p>Open browser: <code>http://&lt;nextcloud-ip&gt;</code></p> </li> <li> <p>Login with:</p> </li> <li>Username: admin</li> <li> <p>Password: [password you set in Step 6]</p> </li> <li> <p>You should see the Nextcloud dashboard</p> </li> </ol>"},{"location":"03-software/02-nextcloud/#step-12-initial-configuration","title":"Step 12: Initial Configuration","text":"<p>Configure Email (optional): - Settings \u2192 Administration \u2192 Basic settings - Email server settings</p> <p>Enable Apps: - Apps \u2192 Your apps - Enable useful apps:   - Calendar   - Contacts   - Tasks   - Notes</p> <p>Configure Sharing: - Settings \u2192 Administration \u2192 Sharing - Set appropriate sharing policies</p>"},{"location":"03-software/02-nextcloud/#step-13-create-backup-script","title":"Step 13: Create Backup Script","text":"<p>```bash cat &gt; ~/backup-nextcloud.sh &lt;&lt; 'EOF'</p>"},{"location":"03-software/02-nextcloud/#binbash","title":"!/bin/bash","text":"<p>TIMESTAMP=$(date +%Y%m%d_%H%M%S) BACKUP_DIR=\"$HOME/backups\" mkdir -p $BACKUP_DIR</p>"},{"location":"03-software/02-nextcloud/#enable-maintenance-mode","title":"Enable maintenance mode","text":"<p>sudo nextcloud.occ maintenance:mode --on</p>"},{"location":"03-software/02-nextcloud/#backup-data-directory","title":"Backup data directory","text":"<p>tar -czf $BACKUP_DIR/nextcloud_data_$TIMESTAMP.tar.gz /var/snap/nextcloud/common/nextcloud/data</p>"},{"location":"03-software/02-nextcloud/#export-database","title":"Export database","text":"<p>sudo nextcloud.export &gt; $BACKUP_DIR/nextcloud_db_$TIMESTAMP.sql</p>"},{"location":"03-software/02-nextcloud/#disable-maintenance-mode","title":"Disable maintenance mode","text":"<p>sudo nextcloud.occ maintenance:mode --off</p>"},{"location":"03-software/02-nextcloud/#keep-only-last-7-backups","title":"Keep only last 7 backups","text":"<p>ls -t $BACKUP_DIR/.tar.gz | tail -n +8 | xargs -r rm ls -t $BACKUP_DIR/.sql | tail -n +8 | xargs -r rm</p> <p>echo \"Backup completed: $TIMESTAMP\"</p>"},{"location":"03-software/03-nginx-reverse-proxy/","title":"Nginx Reverse Proxy and SSL","text":"<p>Brief description: Install Nginx 1.24, configure reverse proxy for all services, and obtain SSL certificates.</p>"},{"location":"03-software/03-nginx-reverse-proxy/#what-youll-learn","title":"What You'll Learn","text":"<ul> <li>How to install Nginx and Certbot</li> <li>How to configure reverse proxy for backend services</li> <li>How to obtain and configure SSL certificates</li> </ul>"},{"location":"03-software/03-nginx-reverse-proxy/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] VM-103 created and Ubuntu 24.04 LTS installed</li> <li>[ ] IP address assigned and documented</li> <li>[ ] Backend services installed (Rocket.Chat, Nextcloud)</li> <li>[ ] Domain names planned (chat.example.com, cloud.example.com, etc.)</li> <li>[ ] Ports 80 and 443 available on public IP</li> </ul>"},{"location":"03-software/03-nginx-reverse-proxy/#estimated-time","title":"Estimated Time","text":"<p>4-6 hours</p>"},{"location":"03-software/03-nginx-reverse-proxy/#step-by-step-instructions","title":"Step-by-Step Instructions","text":""},{"location":"03-software/03-nginx-reverse-proxy/#step-1-ssh-to-nginx-proxy-vm","title":"Step 1: SSH to Nginx Proxy VM","text":"<pre><code>ssh admin@&lt;nginx-ip&gt;\n</code></pre>"},{"location":"03-software/03-nginx-reverse-proxy/#step-2-update-system","title":"Step 2: Update System","text":"<pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y\n</code></pre>"},{"location":"03-software/03-nginx-reverse-proxy/#step-3-install-nginx","title":"Step 3: Install Nginx","text":"<pre><code>sudo apt install -y nginx\n</code></pre> <p>Verify installation:</p> <pre><code>nginx -v\n</code></pre> <p>Expected: nginx version: nginx/1.24.x</p> <p>Start Nginx:</p> <pre><code>sudo systemctl enable nginx\nsudo systemctl start nginx\n</code></pre> <p>Test:</p> <pre><code>curl http://localhost\n</code></pre> <p>Should show \"Welcome to nginx!\"</p>"},{"location":"03-software/03-nginx-reverse-proxy/#step-4-install-certbot","title":"Step 4: Install Certbot","text":"<pre><code>sudo apt install -y certbot python3-certbot-nginx\n</code></pre> <p>Verify:</p> <pre><code>certbot --version\n</code></pre>"},{"location":"03-software/03-nginx-reverse-proxy/#step-5-configure-firewall","title":"Step 5: Configure Firewall","text":"<pre><code>sudo ufw allow 'Nginx Full'\nsudo ufw allow OpenSSH\nsudo ufw enable\n</code></pre> <p>Check status:</p> <pre><code>sudo ufw status\n</code></pre>"},{"location":"03-software/03-nginx-reverse-proxy/#step-6-create-upstream-definitions","title":"Step 6: Create Upstream Definitions","text":"<pre><code>sudo nano /etc/nginx/conf.d/upstreams.conf\n</code></pre> <p>Add:</p> <pre><code># Upstream definitions for backend services\n\nupstream rocketchat_backend {\n    server &lt;rocketchat-ip&gt;:3000;\n}\n\nupstream nextcloud_backend {\n    server &lt;nextcloud-ip&gt;:80;\n}\n\nupstream keycloak_backend {\n    server &lt;keycloak-ip&gt;:8080;\n}\n\nupstream mkdocs_backend {\n    server &lt;mkdocs-ip&gt;:8000;\n}\n</code></pre> <p>Save (Ctrl+O, Enter, Ctrl+X)</p>"},{"location":"03-software/03-nginx-reverse-proxy/#step-7-create-http-to-https-redirect","title":"Step 7: Create HTTP to HTTPS Redirect","text":"<pre><code>sudo nano /etc/nginx/sites-available/redirect\n</code></pre> <p>Add:</p> <pre><code># HTTP to HTTPS redirect for all domains\nserver {\n    listen 80 default_server;\n    listen [::]:80 default_server;\n    server_name _;\n\n    location /.well-known/acme-challenge/ {\n        root /var/www/certbot;\n    }\n\n    location / {\n        return 301 https://$host$request_uri;\n    }\n}\n</code></pre>"},{"location":"03-software/03-nginx-reverse-proxy/#step-8-create-rocketchat-configuration","title":"Step 8: Create Rocket.Chat Configuration","text":"<pre><code>sudo nano /etc/nginx/sites-available/rocketchat\n</code></pre> <p>Add:</p> <pre><code>server {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name chat.example.com;\n\n    ssl_certificate /etc/letsencrypt/live/chat.example.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/chat.example.com/privkey.pem;\n\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n    ssl_prefer_server_ciphers on;\n\n    # WebSocket support for Rocket.Chat\n    location / {\n        proxy_pass http://rocketchat_backend;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n        proxy_set_header Host $http_host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header X-Nginx-Proxy true;\n        proxy_redirect off;\n\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n}\n</code></pre>"},{"location":"03-software/03-nginx-reverse-proxy/#step-9-create-nextcloud-configuration","title":"Step 9: Create Nextcloud Configuration","text":"<pre><code>sudo nano /etc/nginx/sites-available/nextcloud\n</code></pre> <p>Add:</p> <pre><code>server {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name cloud.example.com;\n\n    ssl_certificate /etc/letsencrypt/live/cloud.example.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/cloud.example.com/privkey.pem;\n\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n    ssl_prefer_server_ciphers on;\n\n    client_max_body_size 10G;\n    client_body_timeout 300s;\n    fastcgi_buffers 64 4K;\n\n    location / {\n        proxy_pass http://nextcloud_backend;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header X-Forwarded-Host $server_name;\n\n        proxy_buffering off;\n        proxy_request_buffering off;\n    }\n}\n</code></pre>"},{"location":"03-software/03-nginx-reverse-proxy/#step-10-enable-sites","title":"Step 10: Enable Sites","text":"<p>Remove default site:</p> <pre><code>sudo rm /etc/nginx/sites-enabled/default\n</code></pre> <p>Enable redirect:</p> <pre><code>sudo ln -s /etc/nginx/sites-available/redirect /etc/nginx/sites-enabled/\n</code></pre> <p>Test configuration:</p> <pre><code>sudo nginx -t\n</code></pre> <p>Should show \"syntax is ok\" and \"test is successful\"</p>"},{"location":"03-software/03-nginx-reverse-proxy/#step-11-obtain-ssl-certificates","title":"Step 11: Obtain SSL Certificates","text":"<p>Create webroot for Certbot:</p> <pre><code>sudo mkdir -p /var/www/certbot\n</code></pre> <p>Obtain certificates:</p> <pre><code>sudo certbot certonly --webroot -w /var/www/certbot \\\n  -d chat.example.com \\\n  -d cloud.example.com \\\n  -d auth.example.com \\\n  -d docs.example.com\n</code></pre> <p>Follow prompts: - Enter email address - Accept terms of service - Choose whether to share email with EFF</p>"},{"location":"03-software/03-nginx-reverse-proxy/#step-12-enable-service-sites","title":"Step 12: Enable Service Sites","text":"<p>Now that certificates exist, enable service configurations:</p> <pre><code>sudo ln -s /etc/nginx/sites-available/rocketchat /etc/nginx/sites-enabled/\nsudo ln -s /etc/nginx/sites-available/nextcloud /etc/nginx/sites-enabled/\n</code></pre> <p>Test and reload:</p> <pre><code>sudo nginx -t\nsudo systemctl reload nginx\n</code></pre>"},{"location":"03-software/03-nginx-reverse-proxy/#step-13-setup-auto-renewal","title":"Step 13: Setup Auto-Renewal","text":"<p>Test renewal:</p> <pre><code>sudo certbot renew --dry-run\n</code></pre> <p>Enable timer:</p> <pre><code>sudo systemctl enable certbot.timer\nsudo systemctl start certbot.timer\n</code></pre> <p>Verify timer:</p> <pre><code>sudo systemctl status certbot.timer\n</code></pre>"},{"location":"03-software/03-nginx-reverse-proxy/#step-14-test-access","title":"Step 14: Test Access","text":"<p>Test Rocket.Chat:</p> <pre><code>curl -I https://chat.example.com\n</code></pre> <p>Test Nextcloud:</p> <pre><code>curl -I https://cloud.example.com\n</code></pre> <p>Both should return HTTP 200 or 302.</p>"},{"location":"03-software/03-nginx-reverse-proxy/#verification","title":"Verification","text":"<ul> <li>[ ] Nginx installed and running</li> <li>[ ] Certbot installed</li> <li>[ ] Firewall configured (UFW)</li> <li>[ ] Upstream definitions created</li> <li>[ ] HTTP to HTTPS redirect configured</li> <li>[ ] SSL certificates obtained for all domains</li> <li>[ ] Rocket.Chat reverse proxy configured</li> <li>[ ] Nextcloud reverse proxy configured</li> <li>[ ] Configuration syntax valid</li> <li>[ ] Sites enabled and Nginx reloaded</li> <li>[ ] Auto-renewal configured</li> <li>[ ] HTTPS access working for all services</li> </ul>"},{"location":"03-software/03-nginx-reverse-proxy/#common-issues","title":"Common Issues","text":""},{"location":"03-software/03-nginx-reverse-proxy/#issue-certbot-command-not-found","title":"Issue: certbot: command not found","text":"<p>Solution:  <pre><code>sudo apt install -y certbot python3-certbot-nginx\n</code></pre></p>"},{"location":"03-software/03-nginx-reverse-proxy/#issue-nginx-emerg-bind-to-000080-failed","title":"Issue: nginx: [emerg] bind() to 0.0.0.0:80 failed","text":"<p>Solution: Something else is using port 80: <pre><code>sudo lsof -i :80\nsudo systemctl stop apache2  # if Apache is running\nsudo systemctl disable apache2\n</code></pre></p>"},{"location":"03-software/03-nginx-reverse-proxy/#issue-certificate-validation-failed","title":"Issue: Certificate validation failed","text":"<p>Solution: Ensure DNS points to your server IP: <pre><code>nslookup chat.example.com\n# Should return your server IP\n</code></pre></p>"},{"location":"03-software/03-nginx-reverse-proxy/#issue-websocket-errors-in-rocketchat","title":"Issue: WebSocket errors in Rocket.Chat","text":"<p>Solution: Ensure WebSocket headers are configured: <pre><code>sudo nano /etc/nginx/sites-available/rocketchat\n# Verify these lines exist:\n# proxy_set_header Upgrade $http_upgrade;\n# proxy_set_header Connection \"upgrade\";\n</code></pre></p>"},{"location":"03-software/03-nginx-reverse-proxy/#issue-large-file-uploads-fail-in-nextcloud","title":"Issue: Large file uploads fail in Nextcloud","text":"<p>Solution: Already configured with <code>client_max_body_size 10G</code>. If still failing, check Nextcloud settings.</p>"},{"location":"03-software/03-nginx-reverse-proxy/#next-steps","title":"Next Steps","text":"<ul> <li>OpenLDAP Server (after all services configured)</li> <li>Keycloak &amp; OIDC</li> </ul>"},{"location":"03-software/04-keycloak-oidc/","title":"Keycloak Installation and OIDC Configuration","text":"<p>Brief description: Install Keycloak 24.0.0, configure OpenLDAP federation, and set up OIDC for SSO.</p>"},{"location":"03-software/04-keycloak-oidc/#what-youll-learn","title":"What You'll Learn","text":"<ul> <li>How to install Keycloak 24.0.0</li> <li>How to configure OpenLDAP user federation</li> <li>How to create OIDC clients for SSO</li> <li>How to integrate with Rocket.Chat and Nextcloud</li> </ul>"},{"location":"03-software/04-keycloak-oidc/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] VM-106 created and Ubuntu 24.04 LTS installed</li> <li>[ ] VM-105 (OpenLDAP) created and accessible</li> <li>[ ] OpenJDK 17 installed on Keycloak VM</li> <li>[ ] IP addresses documented</li> <li>[ ] Nginx reverse proxy configured</li> </ul>"},{"location":"03-software/04-keycloak-oidc/#estimated-time","title":"Estimated Time","text":"<p>6-8 hours (Days 7-8 combined)</p>"},{"location":"03-software/04-keycloak-oidc/#part-1-keycloak-installation","title":"Part 1: Keycloak Installation","text":""},{"location":"03-software/04-keycloak-oidc/#step-1-ssh-to-keycloak-vm","title":"Step 1: SSH to Keycloak VM","text":"<pre><code>ssh admin@&lt;keycloak-ip&gt;\n</code></pre>"},{"location":"03-software/04-keycloak-oidc/#step-2-verify-java-installation","title":"Step 2: Verify Java Installation","text":"<pre><code>java -version\n</code></pre> <p>Should show OpenJDK 17.</p> <p>If not installed:</p> <pre><code>sudo apt update\nsudo apt install -y openjdk-17-jdk\n</code></pre>"},{"location":"03-software/04-keycloak-oidc/#step-3-download-and-install-keycloak","title":"Step 3: Download and Install Keycloak","text":"<pre><code>cd /tmp\nwget https://github.com/keycloak/keycloak/releases/download/24.0.0/keycloak-24.0.0.tar.gz\n</code></pre> <p>Extract:</p> <pre><code>sudo tar -xzf keycloak-24.0.0.tar.gz -C /opt/\nsudo mv /opt/keycloak-24.0.0 /opt/keycloak\n</code></pre>"},{"location":"03-software/04-keycloak-oidc/#step-4-create-keycloak-user","title":"Step 4: Create Keycloak User","text":"<pre><code>sudo groupadd keycloak\nsudo useradd -r -g keycloak -d /opt/keycloak -s /sbin/nologin keycloak\n</code></pre> <p>Set ownership:</p> <pre><code>sudo chown -R keycloak:keycloak /opt/keycloak\nsudo mkdir -p /opt/keycloak/data\nsudo mkdir -p /var/log/keycloak\nsudo chown keycloak:keycloak /opt/keycloak/data /var/log/keycloak\n</code></pre>"},{"location":"03-software/04-keycloak-oidc/#step-5-create-systemd-service","title":"Step 5: Create Systemd Service","text":"<pre><code>sudo nano /etc/systemd/system/keycloak.service\n</code></pre> <p>Add:</p> <pre><code>[Unit]\nDescription=Keycloak Identity Provider\nAfter=network.target\n\n[Service]\nType=idle\nUser=keycloak\nGroup=keycloak\nExecStart=/opt/keycloak/bin/kc.sh start --hostname=auth.example.com --http-port=8080 --proxy-headers=xforwarded --log=console\nWorkingDirectory=/opt/keycloak\nRestart=always\nRestartSec=10\nEnvironment=\"JAVA_OPTS=-Xms1024m -Xmx2048m -Djava.security.egd=file:/dev/./urandom\"\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>"},{"location":"03-software/04-keycloak-oidc/#step-6-create-admin-user","title":"Step 6: Create Admin User","text":"<pre><code>cd /opt/keycloak\nsudo -u keycloak bin/kc.sh bootstrap-admin user --username admin --password &lt;admin-password&gt;\n</code></pre> <p>Replace <code>&lt;admin-password&gt;</code> with a strong password.</p>"},{"location":"03-software/04-keycloak-oidc/#step-7-start-keycloak","title":"Step 7: Start Keycloak","text":"<pre><code>sudo systemctl daemon-reload\nsudo systemctl enable keycloak\nsudo systemctl start keycloak\n</code></pre> <p>Check status:</p> <pre><code>sudo systemctl status keycloak\n</code></pre> <p>View logs:</p> <pre><code>sudo journalctl -u keycloak -f\n</code></pre> <p>Wait for \"Listening on: http://0.0.0.0:8080\"</p> <p>Press Ctrl+C to exit logs.</p>"},{"location":"03-software/04-keycloak-oidc/#step-8-access-admin-console","title":"Step 8: Access Admin Console","text":"<p>Open browser: <code>https://auth.example.com/admin</code></p> <p>Login: - Username: admin - Password: [password you set]</p>"},{"location":"03-software/04-keycloak-oidc/#part-2-openldap-configuration","title":"Part 2: OpenLDAP Configuration","text":""},{"location":"03-software/04-keycloak-oidc/#step-9-configure-openldap-vm-105","title":"Step 9: Configure OpenLDAP (VM-105)","text":"<p>SSH to OpenLDAP VM:</p> <pre><code>ssh admin@&lt;openldap-ip&gt;\n</code></pre> <p>Install OpenLDAP:</p> <pre><code>sudo apt update\nsudo apt install -y slapd ldap-utils\n</code></pre> <p>Reconfigure:</p> <pre><code>sudo dpkg-reconfigure slapd\n</code></pre> <p>Answer wizard: - Omit OpenLDAP server configuration? No - DNS domain name: example.com - Organization name: Your Organization - Administrator password: [strong password] - Database backend: MDB - Remove database when slapd is purged? No - Move old database? Yes</p>"},{"location":"03-software/04-keycloak-oidc/#step-10-configure-ldap-tls","title":"Step 10: Configure LDAP TLS","text":"<p>Create certificate directory:</p> <pre><code>sudo mkdir -p /etc/ldap/certs\n</code></pre> <p>Generate self-signed certificate:</p> <pre><code>cd /etc/ldap/certs\nsudo openssl req -new -x509 -days 365 -nodes \\\n  -out ldap.crt \\\n  -keyout ldap.key \\\n  -subj \"/C=US/ST=State/L=City/O=Organization/CN=ldap.example.com\"\n</code></pre> <p>Set permissions:</p> <pre><code>sudo chown openldap:openldap /etc/ldap/certs/ldap.key\nsudo chmod 600 /etc/ldap/certs/ldap.key\n</code></pre>"},{"location":"03-software/04-keycloak-oidc/#step-11-create-base-structure","title":"Step 11: Create Base Structure","text":"<p>Create LDIF file:</p> <p>```bash cat &gt; ~/base-structure.ldif &lt;&lt; 'EOF' dn: ou=users,dc=example,dc=com objectClass: organizationalUnit ou: users</p> <p>dn: ou=groups,dc=example,dc=com objectClass: organizationalUnit ou: groups</p>"},{"location":"04-security/01-firewall/","title":"Firewall Configuration","text":"<p>Brief description: Configure UFW firewall on all VMs with appropriate rules for each service.</p>"},{"location":"04-security/01-firewall/#what-youll-learn","title":"What You'll Learn","text":"<ul> <li>How to configure UFW firewall</li> <li>How to set up firewall rules for each VM role</li> <li>How to prevent SSH lockout</li> </ul>"},{"location":"04-security/01-firewall/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] All VMs created and Ubuntu installed</li> <li>[ ] IP addresses documented</li> <li>[ ] SSH access to all VMs confirmed</li> </ul>"},{"location":"04-security/01-firewall/#vm-firewall-rules-overview","title":"VM Firewall Rules Overview","text":"VM Incoming Allowed From rocketchat 3000 nginx-proxy nextcloud 80, 443 nginx-proxy nginx-proxy 80, 443 Internet mkdocs 8000 nginx-proxy openldap 389, 636 keycloak keycloak 8080 nginx-proxy ALL VMs 22 Admin IPs only"},{"location":"04-security/01-firewall/#rocketchat-vm-vm-101","title":"Rocket.Chat VM (VM-101)","text":"<p>SSH to VM:</p> <pre><code>ssh admin@&lt;rocketchat-ip&gt;\n</code></pre> <p>Configure UFW:</p> <pre><code># Install UFW\nsudo apt install -y ufw\n\n# Default deny\nsudo ufw default deny incoming\nsudo ufw default allow outgoing\n\n# Allow SSH (be careful!)\nsudo ufw allow from &lt;your-admin-ip&gt; to any port 22\n\n# Allow Rocket.Chat from Nginx Proxy only\nsudo ufw allow from &lt;nginx-ip&gt; to any port 3000\n\n# Enable firewall\nsudo ufw enable\n\n# Check status\nsudo ufw status verbose\n</code></pre>"},{"location":"04-security/01-firewall/#nextcloud-vm-vm-102","title":"Nextcloud VM (VM-102)","text":"<pre><code>ssh admin@&lt;nextcloud-ip&gt;\n\nsudo apt install -y ufw\nsudo ufw default deny incoming\nsudo ufw default allow outgoing\nsudo ufw allow from &lt;your-admin-ip&gt; to any port 22\nsudo ufw allow from &lt;nginx-ip&gt; to any port 80\nsudo ufw enable\nsudo ufw status verbose\n</code></pre>"},{"location":"04-security/01-firewall/#nginx-proxy-vm-vm-103","title":"Nginx Proxy VM (VM-103)","text":"<pre><code>ssh admin@&lt;nginx-ip&gt;\n\nsudo apt install -y ufw\nsudo ufw default deny incoming\nsudo ufw default allow outgoing\nsudo ufw allow from &lt;your-admin-ip&gt; to any port 22\n\n# Allow HTTP/HTTPS from anywhere\nsudo ufw allow 80/tcp\nsudo ufw allow 443/tcp\n\nsudo ufw enable\nsudo ufw status verbose\n</code></pre>"},{"location":"04-security/01-firewall/#mkdocs-vm-vm-104","title":"MkDocs VM (VM-104)","text":"<pre><code>ssh admin@&lt;mkdocs-ip&gt;\n\nsudo apt install -y ufw\nsudo ufw default deny incoming\nsudo ufw default allow outgoing\nsudo ufw allow from &lt;your-admin-ip&gt; to any port 22\nsudo ufw allow from &lt;nginx-ip&gt; to any port 8000\nsudo ufw enable\nsudo ufw status verbose\n</code></pre>"},{"location":"04-security/01-firewall/#openldap-vm-vm-105","title":"OpenLDAP VM (VM-105)","text":"<pre><code>ssh admin@&lt;ldap-ip&gt;\n\nsudo apt install -y ufw\nsudo ufw default deny incoming\nsudo ufw default allow outgoing\nsudo ufw allow from &lt;your-admin-ip&gt; to any port 22\n\n# LDAP ports - only from Keycloak\nsudo ufw allow from &lt;keycloak-ip&gt; to any port 389\nsudo ufw allow from &lt;keycloak-ip&gt; to any port 636\n\nsudo ufw enable\nsudo ufw status verbose\n</code></pre>"},{"location":"04-security/01-firewall/#keycloak-vm-vm-106","title":"Keycloak VM (VM-106)","text":"<pre><code>ssh admin@&lt;keycloak-ip&gt;\n\nsudo apt install -y ufw\nsudo ufw default deny incoming\nsudo ufw default allow outgoing\nsudo ufw allow from &lt;your-admin-ip&gt; to any port 22\nsudo ufw allow from &lt;nginx-ip&gt; to any port 8080\nsudo ufw enable\nsudo ufw status verbose\n</code></pre>"},{"location":"04-security/01-firewall/#verification","title":"Verification","text":"<ul> <li>[ ] UFW installed on all VMs</li> <li>[ ] Default deny incoming configured</li> <li>[ ] SSH allowed from admin IP only</li> <li>[ ] Service ports allowed from appropriate sources</li> <li>[ ] Firewall enabled on all VMs</li> <li>[ ] Status verified on all VMs</li> </ul>"},{"location":"04-security/01-firewall/#common-issues","title":"Common Issues","text":""},{"location":"04-security/01-firewall/#issue-locked-out-of-ssh","title":"Issue: Locked out of SSH","text":"<p>Solution: Access via Proxmox console and disable UFW: <pre><code>sudo ufw disable\n</code></pre></p>"},{"location":"04-security/01-firewall/#issue-services-not-reachable","title":"Issue: Services not reachable","text":"<p>Solution: Check UFW logs: <pre><code>sudo ufw logging on\nsudo tail -f /var/log/ufw.log\n</code></pre></p>"},{"location":"04-security/01-firewall/#next-steps","title":"Next Steps","text":"<ul> <li>Fail2Ban Configuration</li> </ul>"},{"location":"04-security/02-fail2ban/","title":"Fail2Ban Configuration","text":"<p>Brief description: Install and configure Fail2Ban on all VMs for intrusion prevention.</p>"},{"location":"04-security/02-fail2ban/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Firewall configured on all VMs</li> <li>[ ] SSH access confirmed</li> </ul>"},{"location":"04-security/02-fail2ban/#installation","title":"Installation","text":"<p>On each VM:</p> <pre><code>sudo apt install -y fail2ban\nsudo systemctl enable fail2ban\nsudo systemctl start fail2ban\n</code></pre>"},{"location":"04-security/02-fail2ban/#configuration","title":"Configuration","text":""},{"location":"04-security/02-fail2ban/#basic-ssh-protection","title":"Basic SSH Protection","text":"<p>Create jail configuration:</p> <pre><code>sudo nano /etc/fail2ban/jail.local\n</code></pre> <p>Add:</p> <pre><code>[DEFAULT]\nbantime = 3600\nfindtime = 600\nmaxretry = 3\nbackend = systemd\n\n[sshd]\nenabled = true\nport = 22\nfilter = sshd\nlogpath = /var/log/auth.log\nmaxretry = 3\n</code></pre> <p>Restart:</p> <pre><code>sudo systemctl restart fail2ban\n</code></pre>"},{"location":"04-security/02-fail2ban/#nginx-proxy-additional-rules","title":"Nginx Proxy Additional Rules","text":"<pre><code>sudo nano /etc/fail2ban/jail.local\n</code></pre> <p>Add:</p> <pre><code>[nginx-http-auth]\nenabled = true\nport = http,https\nfilter = nginx-http-auth\nlogpath = /var/log/nginx/error.log\nmaxretry = 3\n\n[nginx-badbots]\nenabled = true\nport = http,https\nfilter = nginx-badbots\nlogpath = /var/log/nginx/access.log\nmaxretry = 2\n</code></pre>"},{"location":"04-security/02-fail2ban/#verification","title":"Verification","text":"<ul> <li>[ ] Fail2Ban installed on all VMs</li> <li>[ ] SSH jail enabled</li> <li>[ ] Nginx jails enabled (on proxy VM)</li> <li>[ ] Service running</li> <li>[ ] Status checked with: sudo fail2ban-client status</li> </ul>"},{"location":"04-security/02-fail2ban/#next-steps","title":"Next Steps","text":"<ul> <li>Backup and Snapshots</li> </ul>"},{"location":"04-security/03-backup-snapshots/","title":"Backup and ZFS Snapshots","text":"<p>Brief description: Configure ZFS snapshots and remote backups for all VMs.</p>"},{"location":"04-security/03-backup-snapshots/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Proxmox host access</li> <li>[ ] ZFS pool healthy</li> <li>[ ] Storage box or remote server for backups</li> </ul>"},{"location":"04-security/03-backup-snapshots/#step-1-install-sanoid","title":"Step 1: Install Sanoid","text":"<p>On Proxmox host:</p> <pre><code>apt install -y sanoid\n</code></pre>"},{"location":"04-security/03-backup-snapshots/#step-2-configure-snapshot-policy","title":"Step 2: Configure Snapshot Policy","text":"<pre><code>nano /etc/sanoid/sanoid.conf\n</code></pre> <p>Add:</p> <pre><code>[rpool/vm-101-disk-0]\nuse_template = production\n\n[rpool/vm-102-disk-0]\nuse_template = production\n\n[rpool/vm-103-disk-0]\nuse_template = production\n\n[rpool/vm-104-disk-0]\nuse_template = production\n\n[rpool/vm-105-disk-0]\nuse_template = production\n\n[rpool/vm-106-disk-0]\nuse_template = production\n\n[template_production]\nfrequently = 0\nhourly = 24\ndaily = 7\nweekly = 4\nmonthly = 3\nyearly = 0\nautosnap = yes\nautoprune = yes\n</code></pre>"},{"location":"04-security/03-backup-snapshots/#step-3-enable-sanoid","title":"Step 3: Enable Sanoid","text":"<pre><code>systemctl enable sanoid.timer\nsystemctl start sanoid.timer\n</code></pre>"},{"location":"04-security/03-backup-snapshots/#step-4-create-backup-script","title":"Step 4: Create Backup Script","text":"<pre><code>cat &gt; /root/backup-replication.sh &lt;&lt; 'EOF'\n#!/bin/bash\nSTORAGE_BOX=\"u12345@u12345.your-storagebox.de\"\nBACKUP_PATH=\"/backup/proxmox\"\nDATE=$(date +%Y%m%d_%H%M%S)\n\nmkdir -p /tmp/zfs-backup-$DATE\n\nfor vm in 101 102 103 104 105 106; do\n    echo \"Backing up VM $vm...\"\n    zfs send rpool/vm-${vm}-disk-0@autosnap_$(date +%Y-%m-%d) | \\\n    gzip &gt; /tmp/zfs-backup-$DATE/vm-${vm}.gz\n    scp /tmp/zfs-backup-$DATE/vm-${vm}.gz ${STORAGE_BOX}:${BACKUP_PATH}/\ndone\n\nrm -rf /tmp/zfs-backup-$DATE\necho \"Backup completed: $DATE\"\nEOF\n\nchmod +x /root/backup-replication.sh\n</code></pre>"},{"location":"04-security/03-backup-snapshots/#step-5-schedule-weekly-backups","title":"Step 5: Schedule Weekly Backups","text":"<pre><code>crontab -e\n</code></pre> <p>Add:</p> <pre><code>0 2 * * 0 /root/backup-replication.sh &gt;&gt; /var/log/backup.log 2&gt;&amp;1\n</code></pre>"},{"location":"04-security/03-backup-snapshots/#verification","title":"Verification","text":"<ul> <li>[ ] Sanoid installed</li> <li>[ ] Snapshot policy configured</li> <li>[ ] Timer enabled</li> <li>[ ] Backup script created</li> <li>[ ] Weekly backup scheduled</li> <li>[ ] Test backup completed</li> </ul>"},{"location":"04-security/03-backup-snapshots/#next-steps","title":"Next Steps","text":"<ul> <li>CIS Hardening</li> </ul>"},{"location":"04-security/04-cis-hardening/","title":"CIS Benchmark Hardening","text":"<p>Brief description: Apply CIS benchmark security hardening to Proxmox host and all VMs.</p>"},{"location":"04-security/04-cis-hardening/#proxmox-host-hardening","title":"Proxmox Host Hardening","text":""},{"location":"04-security/04-cis-hardening/#ssh-hardening","title":"SSH Hardening","text":"<pre><code>nano /etc/ssh/sshd_config\n</code></pre> <p>Set:</p> <pre><code>PermitRootLogin prohibit-password\nPasswordAuthentication no\nMaxAuthTries 3\nClientAliveInterval 300\nClientAliveCountMax 0\nProtocol 2\nX11Forwarding no\n</code></pre> <p>Restart:</p> <pre><code>systemctl restart sshd\n</code></pre>"},{"location":"04-security/04-cis-hardening/#password-policy","title":"Password Policy","text":"<pre><code>apt install -y libpam-pwquality\n\nnano /etc/security/pwquality.conf\n</code></pre> <p>Set:</p> <pre><code>minlen = 14\nminclass = 4\nmaxrepeat = 2\ndcredit = -1\nucredit = -1\nocredit = -1\nlcredit = -1\n</code></pre>"},{"location":"04-security/04-cis-hardening/#kernel-parameters","title":"Kernel Parameters","text":"<pre><code>nano /etc/sysctl.conf\n</code></pre> <p>Add:</p> <pre><code>net.ipv4.ip_forward = 0\nnet.ipv4.conf.all.rp_filter = 1\nnet.ipv4.icmp_echo_ignore_broadcasts = 1\nnet.ipv4.tcp_syncookies = 1\nkernel.randomize_va_space = 2\n</code></pre> <p>Apply:</p> <pre><code>sysctl -p\n</code></pre>"},{"location":"04-security/04-cis-hardening/#auditd","title":"Auditd","text":"<pre><code>apt install -y auditd audispd-plugins\nsystemctl enable auditd\nsystemctl start auditd\n</code></pre>"},{"location":"04-security/04-cis-hardening/#vm-hardening-script","title":"VM Hardening Script","text":"<p>Apply to all VMs:</p> <pre><code>cat &gt; /root/harden-vm.sh &lt;&lt; 'EOF'\n#!/bin/bash\nVM_IP=$1\n\nssh admin@$VM_IP &lt;&lt; 'REMOTE'\nsudo apt install -y libpam-pwquality ufw fail2ban\n\n# SSH hardening\nsudo sed -i 's/#PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config\nsudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config\nsudo systemctl restart sshd\n\n# Password policy\necho \"minlen = 14\nminclass = 3\ndcredit = -1\nucredit = -1\nlcredit = -1\nocredit = -1\" | sudo tee /etc/security/pwquality.conf\n\n# Enable UFW\nsudo ufw default deny incoming\nsudo ufw default allow outgoing\nsudo ufw allow 22/tcp\nsudo ufw enable\n\n# Enable fail2ban\nsudo systemctl enable fail2ban\nsudo systemctl start fail2ban\n\n# Secure permissions\nsudo chmod 600 /etc/shadow\nsudo chmod 600 /etc/gshadow\n\nREMOTE\nEOF\n\nchmod +x /root/harden-vm.sh\n</code></pre> <p>Run for each VM:</p> <pre><code>for ip in &lt;rocketchat-ip&gt; &lt;nextcloud-ip&gt; &lt;nginx-ip&gt; &lt;mkdocs-ip&gt; &lt;ldap-ip&gt; &lt;keycloak-ip&gt;; do\n    /root/harden-vm.sh $ip\ndone\n</code></pre>"},{"location":"04-security/04-cis-hardening/#verification","title":"Verification","text":"<ul> <li>[ ] SSH hardened on all systems</li> <li>[ ] Password policy enforced</li> <li>[ ] Kernel parameters set</li> <li>[ ] Auditd installed and running</li> <li>[ ] VMs hardened with script</li> <li>[ ] Permissions secured</li> </ul>"},{"location":"04-security/04-cis-hardening/#next-steps","title":"Next Steps","text":"<ul> <li>Prometheus &amp; Grafana</li> </ul>"},{"location":"05-monitoring/01-prometheus-grafana/","title":"Prometheus and Grafana Monitoring","text":"<p>Brief description: Deploy Prometheus and Grafana monitoring stack on Proxmox host.</p>"},{"location":"05-monitoring/01-prometheus-grafana/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Proxmox host access</li> <li>[ ] All VMs running</li> <li>[ ] IP addresses documented</li> </ul>"},{"location":"05-monitoring/01-prometheus-grafana/#prometheus-installation","title":"Prometheus Installation","text":""},{"location":"05-monitoring/01-prometheus-grafana/#step-1-create-user","title":"Step 1: Create User","text":"<pre><code>useradd --no-create-home --shell /bin/false prometheus\n</code></pre>"},{"location":"05-monitoring/01-prometheus-grafana/#step-2-install-prometheus","title":"Step 2: Install Prometheus","text":"<pre><code>cd /tmp\nwget https://github.com/prometheus/prometheus/releases/download/v2.51.0/prometheus-2.51.0.linux-amd64.tar.gz\ntar -xzf prometheus-2.51.0.linux-amd64.tar.gz\n\nsudo cp prometheus-2.51.0.linux-amd64/prometheus /usr/local/bin/\nsudo cp prometheus-2.51.0.linux-amd64/promtool /usr/local/bin/\nsudo cp -r prometheus-2.51.0.linux-amd64/consoles /etc/prometheus\nsudo cp -r prometheus-2.51.0.linux-amd64/console_libraries /etc/prometheus\n\nsudo chown -R prometheus:prometheus /etc/prometheus\n</code></pre>"},{"location":"05-monitoring/01-prometheus-grafana/#step-3-configure-prometheus","title":"Step 3: Configure Prometheus","text":"<pre><code>sudo nano /etc/prometheus/prometheus.yml\n</code></pre> <p>Add:</p> <pre><code>global:\n  scrape_interval: 15s\n\nscrape_configs:\n  - job_name: 'prometheus'\n    static_configs:\n      - targets: ['localhost:9090']\n\n  - job_name: 'rocketchat-node'\n    static_configs:\n      - targets: ['&lt;rocketchat-ip&gt;:9100']\n\n  - job_name: 'nextcloud-node'\n    static_configs:\n      - targets: ['&lt;nextcloud-ip&gt;:9100']\n\n  - job_name: 'nginx-node'\n    static_configs:\n      - targets: ['&lt;nginx-ip&gt;:9100']\n</code></pre>"},{"location":"05-monitoring/01-prometheus-grafana/#step-4-create-service","title":"Step 4: Create Service","text":"<pre><code>sudo nano /etc/systemd/system/prometheus.service\n</code></pre> <p>Add:</p> <pre><code>[Unit]\nDescription=Prometheus\nWants=network-online.target\nAfter=network-online.target\n\n[Service]\nUser=prometheus\nGroup=prometheus\nType=simple\nExecStart=/usr/local/bin/prometheus \\\n    --config.file /etc/prometheus/prometheus.yml \\\n    --storage.tsdb.path /var/lib/prometheus/\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Start:</p> <pre><code>sudo systemctl daemon-reload\nsudo systemctl enable prometheus\nsudo systemctl start prometheus\n</code></pre>"},{"location":"05-monitoring/01-prometheus-grafana/#node-exporter-installation","title":"Node Exporter Installation","text":"<p>On each VM:</p> <pre><code>cd /tmp\nwget https://github.com/prometheus/node_exporter/releases/download/v1.7.0/node_exporter-1.7.0.linux-amd64.tar.gz\ntar -xzf node_exporter-1.7.0.linux-amd64.tar.gz\nsudo cp node_exporter-1.7.0.linux-amd64/node_exporter /usr/local/bin/\n\n# Create service\ncat &gt; /tmp/node_exporter.service &lt;&lt; 'EOF'\n[Unit]\nDescription=Node Exporter\n\n[Service]\nUser=node_exporter\nExecStart=/usr/local/bin/node_exporter\n\n[Install]\nWantedBy=default.target\nEOF\n\nsudo useradd --no-create-home --shell /bin/false node_exporter\nsudo cp /tmp/node_exporter.service /etc/systemd/system/\nsudo systemctl daemon-reload\nsudo systemctl enable node_exporter\nsudo systemctl start node_exporter\n\n# Allow from Proxmox\nsudo ufw allow from &lt;proxmox-ip&gt; to any port 9100\n</code></pre>"},{"location":"05-monitoring/01-prometheus-grafana/#grafana-installation","title":"Grafana Installation","text":"<pre><code>apt install -y apt-transport-https software-properties-common wget\n\nwget -q -O /usr/share/keyrings/grafana.key https://apt.grafana.com/gpg.key\necho \"deb [signed-by=/usr/share/keyrings/grafana.key] https://apt.grafana.com stable main\" | tee /etc/apt/sources.list.d/grafana.list\n\napt update\napt install -y grafana\n\nsystemctl enable grafana-server\nsystemctl start grafana-server\n</code></pre>"},{"location":"05-monitoring/01-prometheus-grafana/#verification","title":"Verification","text":"<ul> <li>[ ] Prometheus installed and running</li> <li>[ ] Node exporters on all VMs</li> <li>[ ] Targets showing as UP</li> <li>[ ] Grafana installed</li> <li>[ ] Dashboards accessible</li> </ul>"},{"location":"05-monitoring/01-prometheus-grafana/#next-steps","title":"Next Steps","text":"<ul> <li>Hetzner Monitoring</li> </ul>"},{"location":"05-monitoring/02-hetzner-monitoring/","title":"Hetzner Monitoring Integration","text":"<p>Brief description: Configure Hetzner's built-in monitoring for host-level metrics.</p>"},{"location":"05-monitoring/02-hetzner-monitoring/#prerequisites","title":"Prerequisites","text":"<ul> <li>[ ] Hetzner server active</li> <li>[ ] Access to Hetzner Robot portal</li> </ul>"},{"location":"05-monitoring/02-hetzner-monitoring/#enable-hetzner-monitoring","title":"Enable Hetzner Monitoring","text":"<ol> <li>Log into https://robot.hetzner.com</li> <li>Select your server</li> <li>Click Monitoring tab</li> <li>Enable monitoring</li> <li>Configure alert thresholds:</li> <li>CPU: 90% for 5 minutes</li> <li>RAM: 90% for 5 minutes</li> <li>Disk: 90% for 5 minutes</li> </ol>"},{"location":"05-monitoring/02-hetzner-monitoring/#verification","title":"Verification","text":"<ul> <li>[ ] Hetzner monitoring enabled</li> <li>[ ] Alert thresholds configured</li> <li>[ ] Email notifications set up</li> </ul>"},{"location":"06-maintenance/01-updates/","title":"System Updates","text":"<p>Brief description: Procedures for keeping all systems updated and secure.</p>"},{"location":"06-maintenance/01-updates/#proxmox-host-updates","title":"Proxmox Host Updates","text":"<pre><code># Update package lists\napt update\n\n# Check for upgrades\napt list --upgradable\n\n# Perform upgrade\napt full-upgrade -y\n\n# Check if reboot required\nif [ -f /var/run/reboot-required ]; then\n    echo \"Reboot required\"\nfi\n</code></pre>"},{"location":"06-maintenance/01-updates/#vm-updates","title":"VM Updates","text":"<p>Script to update all VMs:</p> <pre><code>for ip in &lt;rocketchat-ip&gt; &lt;nextcloud-ip&gt; &lt;nginx-ip&gt; &lt;mkdocs-ip&gt; &lt;ldap-ip&gt; &lt;keycloak-ip&gt;; do\n    echo \"Updating $ip...\"\n    ssh admin@$ip \"sudo apt update &amp;&amp; sudo apt upgrade -y\"\ndone\n</code></pre>"},{"location":"06-maintenance/01-updates/#docker-updates-rocketchat","title":"Docker Updates (Rocket.Chat)","text":"<pre><code>ssh admin@&lt;rocketchat-ip&gt;\ncd ~/rocketchat\ndocker compose pull\ndocker compose up -d\n</code></pre>"},{"location":"06-maintenance/01-updates/#snap-updates-nextcloud","title":"Snap Updates (Nextcloud)","text":"<pre><code>ssh admin@&lt;nextcloud-ip&gt;\nsudo snap refresh nextcloud\n</code></pre>"},{"location":"06-maintenance/01-updates/#verification","title":"Verification","text":"<ul> <li>[ ] Update procedures documented</li> <li>[ ] Scripts created</li> <li>[ ] Tested on one VM</li> </ul>"},{"location":"06-maintenance/01-updates/#schedule","title":"Schedule","text":"<ul> <li>Security updates: Weekly</li> <li>Regular updates: Monthly</li> <li>Major upgrades: Quarterly</li> </ul>"},{"location":"06-maintenance/02-rollback/","title":"Emergency Rollback Procedures","text":"<p>Brief description: Procedures for emergency recovery and rollback.</p>"},{"location":"06-maintenance/02-rollback/#vm-rollback","title":"VM Rollback","text":"<p>From Proxmox:</p> <ol> <li>Select VM</li> <li>Go to Snapshots</li> <li>Select snapshot to restore</li> <li>Click Rollback</li> <li>Confirm</li> </ol>"},{"location":"06-maintenance/02-rollback/#zfs-rollback","title":"ZFS Rollback","text":"<pre><code># List snapshots\nzfs list -t snapshot\n\n# Rollback to specific snapshot\nzfs rollback rpool/vm-101-disk-0@snapshot-name\n</code></pre>"},{"location":"06-maintenance/02-rollback/#service-recovery","title":"Service Recovery","text":""},{"location":"06-maintenance/02-rollback/#rocketchat","title":"Rocket.Chat","text":"<pre><code>cd ~/rocketchat\ndocker compose down\ndocker compose up -d\n</code></pre>"},{"location":"06-maintenance/02-rollback/#nextcloud","title":"Nextcloud","text":"<pre><code>sudo snap restart nextcloud\n</code></pre>"},{"location":"06-maintenance/02-rollback/#keycloak","title":"Keycloak","text":"<pre><code>sudo systemctl restart keycloak\n</code></pre>"},{"location":"06-maintenance/02-rollback/#full-system-recovery","title":"Full System Recovery","text":"<ol> <li>Boot from rescue mode</li> <li>Restore from backup: <pre><code>gunzip -c vm-101-backup.gz | zfs receive rpool/vm-101-disk-0\n</code></pre></li> </ol>"},{"location":"06-maintenance/02-rollback/#verification","title":"Verification","text":"<ul> <li>[ ] Rollback procedures tested</li> <li>[ ] Snapshot restore tested</li> <li>[ ] Backup restoration verified</li> </ul>"},{"location":"06-maintenance/03-doc-update/","title":"Documentation Update Guide","text":"<p>Brief description: How to update this MkDocs documentation.</p>"},{"location":"06-maintenance/03-doc-update/#local-development","title":"Local Development","text":""},{"location":"06-maintenance/03-doc-update/#setup","title":"Setup","text":"<pre><code># Clone repository\ngit clone https://github.com/dmaljkovic/proxmox-lab.git\ncd proxmox-lab\n\n# Install dependencies\npip install -r requirements.txt\n\n# Serve locally\nmkdocs serve\n</code></pre>"},{"location":"06-maintenance/03-doc-update/#making-changes","title":"Making Changes","text":"<ol> <li>Edit files in <code>docs/</code> directory</li> <li>Preview at http://localhost:8000</li> <li>Build: <code>mkdocs build</code></li> </ol>"},{"location":"06-maintenance/03-doc-update/#publishing","title":"Publishing","text":"<pre><code># Commit changes\ngit add .\ngit commit -m \"Update documentation\"\ngit push origin main\n</code></pre> <p>GitHub Actions will automatically deploy to GitHub Pages.</p>"},{"location":"06-maintenance/03-doc-update/#adding-new-pages","title":"Adding New Pages","text":"<ol> <li>Create <code>.md</code> file in appropriate <code>docs/</code> subdirectory</li> <li>Add entry to <code>mkdocs.yml</code> nav section</li> <li>Follow existing format</li> </ol>"},{"location":"06-maintenance/03-doc-update/#verification","title":"Verification","text":"<ul> <li>[ ] Local development setup working</li> <li>[ ] Can build site locally</li> <li>[ ] GitHub Actions deploying successfully</li> </ul>"}]}